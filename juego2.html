<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>La Sombra de Jalejos - Juego de Detective</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Georgia', serif;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: #333;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .game-container {
            max-width: 900px;
            width: 100%;
            background: #f5f1e8;
            border-radius: 15px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.5);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
            color: #ecf0f1;
            padding: 25px;
            text-align: center;
            border-bottom: 4px solid #e67e22;
        }

        .header h1 {
            font-size: 2.2em;
            margin-bottom: 5px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 1em;
            opacity: 0.9;
        }

        .stats-bar {
            display: flex;
            justify-content: space-around;
            padding: 15px;
            background: #ecf0f1;
            border-bottom: 2px solid #bdc3c7;
        }

        .stat {
            text-align: center;
        }

        .stat-label {
            font-size: 0.85em;
            color: #7f8c8d;
            margin-bottom: 5px;
        }

        .stat-value {
            font-size: 1.3em;
            font-weight: bold;
            color: #2c3e50;
        }

        .game-screen {
            padding: 30px;
            min-height: 400px;
        }

        .intro-screen, .location-screen, .interrogation-screen, .end-screen {
            animation: fadeIn 0.5s;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .story-text {
            background: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            line-height: 1.8;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .button {
            background: linear-gradient(135deg, #e67e22 0%, #d35400 100%);
            color: white;
            border: none;
            padding: 15px 30px;
            font-size: 1.1em;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 4px 15px rgba(230, 126, 34, 0.3);
            font-family: 'Georgia', serif;
            margin: 5px;
        }

        .button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(230, 126, 34, 0.5);
        }

        .button:active {
            transform: translateY(0);
        }

        .button-secondary {
            background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);
            box-shadow: 0 4px 15px rgba(52, 152, 219, 0.3);
        }

        .location-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .location-card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
            border: 2px solid transparent;
        }

        .location-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.2);
            border-color: #e67e22;
        }

        .location-card.visited {
            opacity: 0.7;
            background: #ecf0f1;
        }

        .location-icon {
            font-size: 3em;
            margin-bottom: 10px;
        }

        .location-name {
            font-weight: bold;
            font-size: 1.2em;
            color: #2c3e50;
        }

        .clue-search {
            background: white;
            padding: 25px;
            border-radius: 10px;
            margin: 20px 0;
        }

        .clue-item {
            background: #fff9e6;
            padding: 15px;
            margin: 10px 0;
            border-radius: 8px;
            border-left: 4px solid #f39c12;
            cursor: pointer;
            transition: all 0.3s;
        }

        .clue-item:hover {
            background: #fff4d6;
            transform: translateX(5px);
        }

        .clue-found {
            background: #d4edda;
            border-left-color: #28a745;
        }

        .suspect-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .suspect-card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
        }

        .suspect-card:hover {
            transform: scale(1.05);
            box-shadow: 0 8px 20px rgba(0,0,0,0.2);
        }

        .suspect-card.questioned {
            border: 2px solid #3498db;
        }

        .suspect-avatar {
            font-size: 4em;
            text-align: center;
            margin-bottom: 10px;
        }

        .suspect-name {
            font-size: 1.3em;
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 5px;
        }

        .suspect-role {
            color: #7f8c8d;
            font-size: 0.9em;
        }

        .question-box {
            background: white;
            padding: 25px;
            border-radius: 10px;
            margin: 20px 0;
        }

        .question-options {
            margin-top: 15px;
        }

        .question-btn {
            display: block;
            width: 100%;
            text-align: left;
            background: #ecf0f1;
            padding: 15px;
            margin: 10px 0;
            border: 2px solid #bdc3c7;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 1em;
        }

        .question-btn:hover {
            background: #d5dbdb;
            border-color: #e67e22;
        }

        .answer-box {
            background: #e8f5e9;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            border-left: 4px solid #4caf50;
        }

        .notebook {
            background: #fff;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            border: 2px dashed #bdc3c7;
        }

        .notebook h3 {
            color: #2c3e50;
            margin-bottom: 15px;
        }

        .notebook-item {
            padding: 10px;
            margin: 8px 0;
            background: #f8f9fa;
            border-radius: 5px;
            font-size: 0.95em;
        }

        .accusation-panel {
            background: #fff3cd;
            padding: 25px;
            border-radius: 10px;
            border: 2px solid #ffc107;
            margin: 20px 0;
        }

        .end-screen {
            text-align: center;
        }

        .result-box {
            background: white;
            padding: 30px;
            border-radius: 15px;
            margin: 20px 0;
        }

        .result-success {
            border: 4px solid #28a745;
        }

        .result-failure {
            border: 4px solid #dc3545;
        }

        .hidden {
            display: none;
        }

        .badge {
            display: inline-block;
            padding: 5px 12px;
            background: #e67e22;
            color: white;
            border-radius: 20px;
            font-size: 0.85em;
            margin-left: 10px;
        }

        .progress-bar {
            background: #ecf0f1;
            height: 10px;
            border-radius: 5px;
            overflow: hidden;
            margin: 10px 0;
        }

        .progress-fill {
            background: linear-gradient(90deg, #e67e22 0%, #f39c12 100%);
            height: 100%;
            transition: width 0.5s;
        }
    </style>
</head>
<body>
    <div class="game-container">
        <div class="header">
            <h1>üïµÔ∏è La Sombra de Jalejos</h1>
            <p>Detective Hugo L. - Divisi√≥n de Homicidios</p>
        </div>

        <div class="stats-bar">
            <div class="stat">
                <div class="stat-label">Pistas Encontradas</div>
                <div class="stat-value" id="clues-count">0/9</div>
            </div>
            <div class="stat">
                <div class="stat-label">Sospechosos Interrogados</div>
                <div class="stat-value" id="suspects-count">0/4</div>
            </div>
            <div class="stat">
                <div class="stat-label">Tiempo Restante</div>
                <div class="stat-value" id="time-remaining">25:00</div>
            </div>
        </div>

        <div class="game-screen" id="game-screen">
            <!-- Las pantallas del juego se cargar√°n aqu√≠ -->
        </div>
    </div>

    <script>
        // Estado del juego
        const gameState = {
            currentScreen: 'menu',
            currentMission: null,
            cluesFound: [],
            suspectsQuestioned: [],
            timeRemaining: 1500, // 25 minutos en segundos
            timerInterval: null,
            currentLocation: null,
            currentSuspect: null,
            mission1Completed: false,
            mission2Completed: false,
            mission3Completed: false,
            mission4Completed: false,
            // Mission 4 specific
            filesReviewed: [],
            guardsAvoided: 0,
            suspicionLevel: 0
        };

        // Sistema de guardado
        function saveProgress() {
            const saveData = {
                mission1Completed: gameState.mission1Completed,
                mission2Completed: gameState.mission2Completed,
                mission3Completed: gameState.mission3Completed,
                mission4Completed: gameState.mission4Completed
            };
            localStorage.setItem('laSombraDeJalejosProgress', JSON.stringify(saveData));
        }

        function loadProgress() {
            const savedData = localStorage.getItem('laSombraDeJalejosProgress');
            if (savedData) {
                const progress = JSON.parse(savedData);
                gameState.mission1Completed = progress.mission1Completed || false;
                gameState.mission2Completed = progress.mission2Completed || false;
                gameState.mission3Completed = progress.mission3Completed || false;
                gameState.mission4Completed = progress.mission4Completed || false;
            }
        }

        function resetProgress() {
            if (confirm('¬øEst√°s seguro de que quieres reiniciar todo el progreso? Esta acci√≥n no se puede deshacer.')) {
                localStorage.removeItem('laSombraDeJalejosProgress');
                location.reload();
            }
        }

        // Backstory del detective
        const hugoBackstory = {
            sonName: "Miguel L.",
            sonAge: 12,
            cause: "Bala perdida en un tiroteo de pandillas hace 3 a√±os",
            reason: "Desde entonces, Hugo dedic√≥ su vida a limpiar las calles y hacer justicia"
        };

        // Datos del juego
        const gameData = {
            mission1: {
                locations: [
                    {
                        id: 'alley',
                        name: 'Callej√≥n del Crimen',
                        icon: 'üèöÔ∏è',
                        clues: ['blood_trail', 'green_symbol', 'torn_clothing']
                    },
                    {
                        id: 'victim_belongings',
                        name: 'Pertenencias de la V√≠ctima',
                        icon: 'üéí',
                        clues: ['empty_wallet', 'old_photo']
                    },
                    {
                        id: 'nearby_bar',
                        name: 'Bar Cercano',
                        icon: 'üç∫',
                        clues: ['witness_statement', 'security_footage']
                    },
                    {
                        id: 'abandoned_warehouse',
                        name: 'Almac√©n Abandonado',
                        icon: 'üè≠',
                        clues: ['green_graffiti', 'weapon']
                    }
                ],
                clues: {
                    'blood_trail': { name: 'Rastro de Sangre', description: 'Un rastro de sangre que va desde el cuerpo hasta la calle principal. La v√≠ctima intent√≥ escapar.' },
                    'green_symbol': { name: 'S√≠mbolo Verde', description: '‚ö†Ô∏è Un extra√±o s√≠mbolo pintado en verde en la pared: tres l√≠neas verticales con un c√≠rculo. Marca del clan "Los Verdes".' },
                    'torn_clothing': { name: 'Ropa Desgarrada', description: 'La ropa de la v√≠ctima est√° desgarrada, se√±ales de forcejeo. No parece un simple robo.' },
                    'empty_wallet': { name: 'Cartera Vac√≠a', description: 'La cartera est√° vac√≠a, sin dinero ni documentos. ¬øRobo o fue algo m√°s?' },
                    'old_photo': { name: 'Fotograf√≠a Antigua', description: 'Una foto vieja del vagabundo con un hombre en traje. Al reverso dice: "Hermanos para siempre".' },
                    'witness_statement': { name: 'Testimonio de Testigo', description: 'Un cliente del bar vio a alguien con sudadera verde salir corriendo del callej√≥n cerca de las 11 PM.' },
                    'security_footage': { name: 'Grabaci√≥n de Seguridad', description: 'La c√°mara del bar muestra a una figura encapuchada merodeando el callej√≥n minutos antes.' },
                    'green_graffiti': { name: 'Grafiti Verde', description: '‚ö†Ô∏è M√∫ltiples grafitis con el s√≠mbolo de "Los Verdes" en las paredes. Este es su territorio.' },
                    'weapon': { name: 'Arma Homicida', description: 'Un tubo de metal manchado con sangre escondido detr√°s de unos barriles. Tiene huellas dactilares.' }
                },
                suspects: [
                    {
                        id: 'dealer',
                        name: 'Marco "El Flaco" Silva',
                        role: 'Traficante de Poca Monta',
                        avatar: 'üß¢',
                        guilty: true,
                        questions: {
                            whereabouts: 'Estaba en mi casa viendo tele. No sal√≠ en toda la noche.',
                            motive: 'No conoc√≠a al tipo. ¬øPor qu√© matar√≠a a un vagabundo sin nada?',
                            access: 'Paso por ese callej√≥n a veces, como todo el mundo. No significa nada.'
                        },
                        clueReveals: {
                            weapon: 'Est√° bien... estuve ah√≠. Pero no fue idea m√≠a. ¬°Me obligaron!',
                            green_symbol: 'Los Verdes... ellos me dieron la orden. Si no obedec√≠a, me matar√≠an a m√≠. ¬°Ten√≠an que silenciarlo!'
                        }
                    },
                    {
                        id: 'bartender',
                        name: 'Rosa Mart√≠nez',
                        role: 'Due√±a del Bar',
                        avatar: 'üë©‚Äçüç≥',
                        guilty: false,
                        questions: {
                            whereabouts: 'Estaba trabajando en el bar hasta las 2 AM. Muchos clientes me vieron.',
                            motive: 'El pobre hombre ven√≠a a veces a buscar comida. Le daba lo que sobraba. No le har√≠a da√±o.',
                            access: 'Mi bar est√° justo al lado del callej√≥n. Ojal√° hubiera visto algo √∫til.'
                        }
                    },
                    {
                        id: 'businessman',
                        name: 'Ricardo Mendoza',
                        role: 'Empresario Local',
                        avatar: 'üëî',
                        guilty: false,
                        questions: {
                            whereabouts: 'Estaba en una cena de negocios en el centro. Tengo recibos y testigos.',
                            motive: 'No tengo ninguna relaci√≥n con gente de la calle. Mi mundo es muy diferente.',
                            access: 'Jam√°s paso por esa zona. Es peligrosa.'
                        },
                        clueReveals: {
                            old_photo: '¬øQu√©? Ese... ese era mi hermano menor. Hace a√±os que no lo ve√≠a... cay√≥ en las drogas y desapareci√≥. ¬øEst√° muerto?'
                        }
                    },
                    {
                        id: 'officer',
                        name: 'Agente Patricia Torres',
                        role: 'Polic√≠a de Patrulla',
                        avatar: 'üëÆ‚Äç‚ôÄÔ∏è',
                        guilty: false,
                        questions: {
                            whereabouts: 'Estaba de patrulla en otra zona de la ciudad. Hay registros de mi ronda.',
                            motive: 'Soy polic√≠a. Mi trabajo es proteger, no matar.',
                            access: 'Conozco la zona. Los Verdes operan ah√≠. Son peligrosos.'
                        },
                        clueReveals: {
                            green_symbol: 'Ese s√≠mbolo... Los Verdes. Es una banda criminal organizada. Su l√≠der es desconocido, pero son despiadados.',
                            green_graffiti: 'Los Verdes controlan ese territorio. Si alguien los traiciona o amenaza sus operaciones, lo eliminan.'
                        }
                    }
                ]
            },
            mission2: {
                locations: [
                    {
                        id: 'living_room',
                        name: 'Sala de Estar',
                        icon: 'üõãÔ∏è',
                        clues: ['family_photo', 'untouched_dinner', 'tv_on']
                    },
                    {
                        id: 'bedroom',
                        name: 'Dormitorio Principal',
                        icon: 'üõèÔ∏è',
                        clues: ['clothes_missing', 'jewelry_intact', 'passports_gone']
                    },
                    {
                        id: 'kitchen',
                        name: 'Cocina',
                        icon: 'üç≥',
                        clues: ['food_fresh', 'calendar_marked', 'phone_message']
                    },
                    {
                        id: 'garage',
                        name: 'Garaje',
                        icon: 'üöó',
                        clues: ['car_missing', 'suitcases_gone', 'green_note']
                    }
                ],
                clues: {
                    'family_photo': { name: 'Foto Familiar', description: 'Una foto reciente de la familia Ram√≠rez: padre, madre y dos ni√±os peque√±os. Se ven felices.' },
                    'untouched_dinner': { name: 'Cena Intacta', description: 'La mesa est√° puesta para cenar, con comida que apenas se enfri√≥. Se fueron de prisa.' },
                    'tv_on': { name: 'Televisor Encendido', description: 'El televisor sigue encendido, mostrando un programa infantil. Nadie lo apag√≥.' },
                    'clothes_missing': { name: 'Ropa Faltante', description: 'El armario tiene espacios vac√≠os. Se llevaron ropa de urgencia, no todo ordenadamente.' },
                    'jewelry_intact': { name: 'Joyas Intactas', description: 'Las joyas y objetos de valor siguen en su lugar. No fue un robo.' },
                    'passports_gone': { name: 'Pasaportes Desaparecidos', description: '‚ö†Ô∏è CRUCIAL: Los pasaportes de toda la familia han desaparecido. Planeaban huir lejos.' },
                    'food_fresh': { name: 'Comida Fresca', description: 'La leche en el refrigerador todav√≠a est√° fresca. Se fueron hace menos de 24 horas.' },
                    'calendar_marked': { name: 'Calendario Marcado', description: 'El calendario tiene una fecha marcada en rojo hace 3 d√≠as: "Reuni√≥n importante".' },
                    'phone_message': { name: 'Mensaje en el Contestador', description: '‚ö†Ô∏è CRUCIAL: "Se√±or Ram√≠rez, sabemos lo que vio. Mantenga la boca cerrada o su familia pagar√° las consecuencias." Voz distorsionada.' },
                    'car_missing': { name: 'Auto Desaparecido', description: 'El auto familiar no est√° en el garaje. Lo usaron para escapar.' },
                    'suitcases_gone': { name: 'Maletas Ausentes', description: 'Las maletas que normalmente est√°n aqu√≠ han desaparecido. Empacaron lo esencial.' },
                    'green_note': { name: 'Nota Verde', description: '‚ö†Ô∏è CRUCIAL: Una nota amenazante con el s√≠mbolo de Los Verdes: "Al√©jate de nuestros asuntos o desaparece".' }
                },
                conclusions: [
                    {
                        id: 'kidnapped',
                        text: 'Fueron secuestrados por una banda criminal',
                        correct: false,
                        explanation: 'No hay signos de violencia ni forcejeo. Las joyas est√°n intactas y se llevaron los pasaportes voluntariamente.'
                    },
                    {
                        id: 'witness_protection',
                        text: 'Entraron en un programa de protecci√≥n de testigos',
                        correct: false,
                        explanation: 'Si fuera protecci√≥n oficial, no habr√≠an dejado la casa as√≠. Los pasaportes estar√≠an confiscados y tendr√≠an ayuda policial.'
                    },
                    {
                        id: 'threatened_fled',
                        text: 'Huyeron por su cuenta tras recibir amenazas de Los Verdes',
                        correct: true,
                        explanation: '¬°Correcto! El se√±or Ram√≠rez presenci√≥ algo relacionado con Los Verdes. Las amenazas los obligaron a huir r√°pidamente por su cuenta, llevando pasaportes y lo esencial. No confiaron en la polic√≠a por miedo.'
                    },
                    {
                        id: 'planned_vacation',
                        text: 'Se fueron de vacaciones planeadas de √∫ltimo momento',
                        correct: false,
                        explanation: 'La cena intacta, el televisor encendido y la nota amenazante demuestran que fue una huida urgente, no vacaciones.'
                    }
                ]
            },
            mission3: {
                locations: [
                    {
                        id: 'safehouse',
                        name: 'Casa de Seguridad',
                        icon: 'üè†',
                        clues: ['broken_window', 'no_struggle', 'informant_file']
                    },
                    {
                        id: 'street',
                        name: 'Calle Exterior',
                        icon: 'üö∂',
                        clues: ['no_witnesses', 'surveillance_gap', 'professional_hit']
                    },
                    {
                        id: 'police_station',
                        name: 'Estaci√≥n de Polic√≠a',
                        icon: 'üèõÔ∏è',
                        clues: ['database_access', 'limited_knowledge', 'recent_query']
                    }
                ],
                clues: {
                    'broken_window': { name: 'Ventana Rota', description: 'La ventana fue rota desde afuera, pero el cristal est√° disperso de forma extra√±a. Punto de entrada.' },
                    'no_struggle': { name: 'Sin Signos de Lucha', description: '‚ö†Ô∏è CRUCIAL: El informante fue asesinado con un solo disparo. Sin forcejeo, sin defensa. Lo tomaron por sorpresa.' },
                    'informant_file': { name: 'Expediente del Informante', description: 'El expediente estaba sobre la mesa. Informaci√≥n sensible sobre Los Verdes. Iba a testificar ma√±ana.' },
                    'no_witnesses': { name: 'Sin Testigos', description: 'Nadie vio nada. En una calle normalmente transitada. Demasiado conveniente.' },
                    'surveillance_gap': { name: 'Fallo en Vigilancia', description: 'Las c√°maras de seguridad del √°rea "fallaron" exactamente durante 15 minutos. Justo cuando ocurri√≥ el asesinato.' },
                    'professional_hit': { name: 'Ejecuci√≥n Profesional', description: '‚ö†Ô∏è CRUCIAL: Un disparo, calibre profesional, silenciador. Esto fue obra de un sicario experimentado, no un pandillero com√∫n.' },
                    'database_access': { name: 'Registro de Acceso a Base de Datos', description: '‚ö†Ô∏è CRUCIAL: Alguien accedi√≥ a la ubicaci√≥n de la casa de seguridad desde una terminal policial 2 horas antes del asesinato.' },
                    'limited_knowledge': { name: 'Conocimiento Limitado', description: 'Solo 5 personas sab√≠an la ubicaci√≥n exacta: el Capit√°n, dos detectives de confianza, el fiscal y el propio informante.' },
                    'recent_query': { name: 'Consulta Reciente', description: '‚ö†Ô∏è CRUCIAL: El acceso a la base de datos fue desde una terminal de alto rango. Requiere credenciales de oficial superior o fiscal.' }
                },
                suspects: [
                    {
                        id: 'street_cop',
                        name: 'Oficial Javier Mendoza',
                        role: 'Polic√≠a de Patrulla - Zona del Crimen',
                        avatar: 'üëÆ',
                        guilty: false,
                        questions: {
                            whereabouts: 'Estaba en mi patrulla, a 3 cuadras. No vi ni o√≠ nada. Cuando llegu√©, ya hab√≠a pasado todo.',
                            knowledge: 'No sab√≠a nada del informante. Eso est√° por encima de mi nivel. Solo patrullaba la zona.',
                            suspicion: '¬øPor qu√© me interrogan a m√≠? Soy un simple polic√≠a de calle. Pregunten a los de arriba.'
                        },
                        clueReveals: {
                            database_access: 'Yo no tengo acceso a esas bases de datos. Solo los de alto rango pueden entrar ah√≠.',
                            recent_query: 'Mire mi registro. Yo estaba en la calle, no en ninguna computadora.'
                        }
                    },
                    {
                        id: 'detective_torres',
                        name: 'Detective Ana Torres',
                        role: 'Detective de Narc√≥ticos',
                        avatar: 'üë©‚Äçüíº',
                        guilty: false,
                        questions: {
                            whereabouts: 'Estaba interrogando a otro sospechoso en la estaci√≥n. Hay c√°maras y testigos.',
                            knowledge: 'Sab√≠a del informante, pero no la ubicaci√≥n exacta. El Capit√°n mantiene eso reservado.',
                            suspicion: 'Llevo 15 a√±os en el cuerpo. Mi r√©cord es impecable. Esto me ofende, Hugo.'
                        },
                        clueReveals: {
                            database_access: 'Tengo acceso a la base de datos, s√≠. Pero no consult√© nada esa noche. Revisen los logs.',
                            professional_hit: 'Este asesinato... fue demasiado limpio. Alguien con recursos, con informaci√≥n privilegiada.'
                        }
                    }
                ],
                conclusions: [
                    {
                        id: 'verdes_infiltrated',
                        text: 'Los Verdes infiltraron un sicario en la zona y encontraron al informante por casualidad',
                        correct: false,
                        explanation: 'Imposible. La casa era secreta, en una ubicaci√≥n aleatoria. Las c√°maras fallaron exactamente cuando ocurri√≥. Fue planeado, no casualidad.'
                    },
                    {
                        id: 'informant_betrayed_self',
                        text: 'El informante revel√≥ su ubicaci√≥n accidentalmente a Los Verdes',
                        correct: false,
                        explanation: 'El informante estaba protegido y sin contacto externo. No ten√≠a forma de revelar su ubicaci√≥n. Alguien m√°s lo hizo.'
                    },
                    {
                        id: 'inside_leak',
                        text: 'Hay una filtraci√≥n dentro de la polic√≠a - alguien poderoso protege a Los Verdes',
                        correct: true,
                        explanation: '¬°Correcto! El acceso a la base de datos desde una terminal de alto rango, el timing perfecto, las c√°maras "fallando"... Alguien con poder dentro del departamento o el gobierno est√° protegiendo a Los Verdes. El informante fue vendido desde adentro.'
                    },
                    {
                        id: 'one_of_two_suspects',
                        text: 'Uno de los dos sospechosos es el culpable directo',
                        correct: false,
                        explanation: 'Ninguno de los dos tiene el perfil ni el acceso necesario. El Oficial Mendoza no tiene credenciales de alto rango. La Detective Torres tiene coartada s√≥lida. El verdadero traidor est√° m√°s arriba en la cadena de mando.'
                    }
                ],
                killerOptions: [
                    {
                        id: 'street_cop',
                        name: 'Oficial Javier Mendoza',
                        correct: false,
                        explanation: 'Mendoza es solo un polic√≠a de patrulla. No tiene acceso a bases de datos de alto nivel ni recursos para contratar un sicario profesional.'
                    },
                    {
                        id: 'detective_torres',
                        name: 'Detective Ana Torres',
                        correct: false,
                        explanation: 'Torres tiene coartada s√≥lida y su registro es limpio. Adem√°s, no tiene el nivel de influencia para desactivar c√°maras de seguridad.'
                    },
                    {
                        id: 'unknown_higher',
                        name: 'Alguien de alto rango en la polic√≠a o gobierno (Desconocido)',
                        correct: true,
                        explanation: '¬°Correcto! El verdadero culpable est√° m√°s arriba. Alguien con acceso a bases de datos clasificadas, poder para manipular c√°maras de seguridad, y conexiones con Los Verdes. No puedes arrestarlo todav√≠a... pero ahora sabes que la corrupci√≥n llega hasta arriba.'
                    }
                ]
            },
            mission4: {
                // Esta misi√≥n es diferente - basada en stealth y revisi√≥n de archivos
                archives: [
                    {
                        id: 'case_2019_robbery',
                        name: 'Caso Atraco Banco Central - 2019',
                        suspicionRisk: 1, // bajo
                        important: false,
                        content: 'Atraco com√∫n. Sospechosos capturados. Caso cerrado correctamente.',
                        signedBy: 'Detective Ram√≠rez'
                    },
                    {
                        id: 'case_2020_verde_drugs',
                        name: 'Operativo Antidroga Barrio Este - 2020',
                        suspicionRisk: 2, // medio
                        important: true,
                        content: '‚ö†Ô∏è CR√çTICO: Operativo contra Los Verdes. Se incautaron 50kg de droga. Todos los sospechosos fueron liberados por "falta de evidencia". Caso ARCHIVADO.',
                        signedBy: 'Capit√°n Rodr√≠guez',
                        inconsistency: 'Con 50kg incautados, ¬øc√≥mo puede haber falta de evidencia?'
                    },
                    {
                        id: 'case_2018_traffic',
                        name: 'Accidente de Tr√°fico - 2018',
                        suspicionRisk: 1,
                        important: false,
                        content: 'Accidente vehicular sin v√≠ctimas. Caso cerrado.',
                        signedBy: 'Oficial Mart√≠nez'
                    },
                    {
                        id: 'case_2021_verde_witness',
                        name: 'Testigo Desaparecido - 2021',
                        suspicionRisk: 3, // alto
                        important: true,
                        content: '‚ö†Ô∏è CR√çTICO: Testigo clave contra Los Verdes desapareci√≥ antes del juicio. Investigaci√≥n cerrada como "huida voluntaria". Caso ARCHIVADO.',
                        signedBy: 'Capit√°n Rodr√≠guez',
                        inconsistency: 'El testigo estaba bajo protecci√≥n policial. ¬øC√≥mo "huy√≥ voluntariamente"?'
                    },
                    {
                        id: 'case_2017_homicide',
                        name: 'Homicidio Calle 5ta - 2017',
                        suspicionRisk: 1,
                        important: false,
                        content: 'Homicidio resuelto. Perpetrador encarcelado.',
                        signedBy: 'Detective Torres'
                    },
                    {
                        id: 'case_2022_verde_weapons',
                        name: 'Tr√°fico de Armas Ilegales - 2022',
                        suspicionRisk: 3,
                        important: true,
                        content: '‚ö†Ô∏è CR√çTICO: Incautaci√≥n de arsenal completo vinculado a Los Verdes. Evidencia "extraviada" durante el traslado. Caso ARCHIVADO.',
                        signedBy: 'Capit√°n Rodr√≠guez',
                        inconsistency: 'Evidencia custodiada por la polic√≠a no puede simplemente "extraviarse".'
                    },
                    {
                        id: 'case_2023_verde_informant',
                        name: 'Muerte de Informante - 2023',
                        suspicionRisk: 3,
                        important: true,
                        content: '‚ö†Ô∏è CR√çTICO: Informante contra Los Verdes asesinado. Investigaci√≥n concluida como "suicidio". Caso ARCHIVADO.',
                        signedBy: 'Capit√°n Rodr√≠guez',
                        inconsistency: 'Informe forense indica signos de forcejeo. No es compatible con suicidio.'
                    },
                    {
                        id: 'case_2020_burglary',
                        name: 'Robo a Residencia - 2020',
                        suspicionRisk: 1,
                        important: false,
                        content: 'Robo dom√©stico. Sospechoso identificado y arrestado.',
                        signedBy: 'Detective G√≥mez'
                    }
                ],
                guardPatterns: [
                    { time: 0, location: 'entrance', duration: 5 },
                    { time: 5, location: 'hallway', duration: 5 },
                    { time: 10, location: 'archive_room', duration: 3 },
                    { time: 13, location: 'hallway', duration: 5 },
                    { time: 18, location: 'entrance', duration: 5 }
                ],
                conclusions: [
                    {
                        id: 'boss_innocent',
                        text: 'Las inconsistencias son coincidencias. El Capit√°n Rodr√≠guez es confiable.',
                        correct: false,
                        explanation: 'TODOS los casos archivados con inconsistencias graves est√°n firmados por √©l. Es demasiada "coincidencia".'
                    },
                    {
                        id: 'boss_incompetent',
                        text: 'El Capit√°n es incompetente y cometi√≥ errores graves, pero no corrupto.',
                        correct: false,
                        explanation: 'Un capit√°n experimentado no comete TANTOS errores cr√≠ticos solo en casos de Los Verdes. Hay un patr√≥n intencional.'
                    },
                    {
                        id: 'boss_suspicious_light',
                        text: 'Hay irregularidades preocupantes, pero necesito m√°s evidencia antes de acusar al Capit√°n.',
                        correct: true,
                        explanation: '¬°Correcto! Has detectado un patr√≥n sospechoso: TODOS los casos importantes contra Los Verdes archivados llevan su firma. Pero a√∫n no tienes pruebas concluyentes. Sospechas ligeramente, pero no abiertamente.'
                    },
                    {
                        id: 'boss_definitely_corrupt',
                        text: 'El Capit√°n Rodr√≠guez definitivamente trabaja para Los Verdes.',
                        correct: false,
                        explanation: 'Aunque hay evidencia circunstancial fuerte, saltar a esta conclusi√≥n sin pruebas directas es prematuro y peligroso.'
                    }
                ],
                scapegoatChoice: [
                    {
                        id: 'confess',
                        text: 'Confesar que fuiste t√∫ quien revis√≥ los archivos',
                        outcome: 'hugo_targeted',
                        description: 'Asumes la responsabilidad. Ser√°s interrogado y estar√°s en el radar.'
                    },
                    {
                        id: 'blame_martinez',
                        text: 'Dejar que sospechen del Detective Javier Mart√≠nez (tu compa√±ero)',
                        outcome: 'martinez_targeted',
                        description: 'Mart√≠nez es inocente pero ser√° interrogado y posiblemente castigado.'
                    }
                ]
            },
            mission5: {
                locations: [
                    {
                        id: 'office',
                        name: 'Oficina del Funcionario',
                        icon: 'üè¢',
                        clues: ['body_position', 'locked_door', 'computer_files']
                    },
                    {
                        id: 'desk',
                        name: 'Escritorio y Documentos',
                        icon: 'üìã',
                        clues: ['draft_complaint', 'financial_records', 'threatening_note']
                    },
                    {
                        id: 'phone_records',
                        name: 'Registros Telef√≥nicos',
                        icon: 'üìû',
                        clues: ['last_calls', 'deleted_messages', 'anonymous_contact']
                    },
                    {
                        id: 'security',
                        name: 'Sistema de Seguridad',
                        icon: 'üé•',
                        clues: ['camera_disabled', 'access_log', 'timing_suspicious']
                    }
                ],
                clues: {
                    'body_position': { name: 'Posici√≥n del Cuerpo', description: 'El funcionario muri√≥ en su silla. Un disparo. Suicidio aparente, pero la posici√≥n del arma es extra√±a.' },
                    'locked_door': { name: 'Puerta Cerrada', description: 'La puerta estaba cerrada desde dentro. Pero ¬øc√≥mo sali√≥ el asesino?' },
                    'computer_files': { name: 'Archivos del Computador', description: 'Varios archivos eliminados recientemente. Algo intentaron ocultar.' },
                    'draft_complaint': { name: 'Borrador de Denuncia', description: '‚ö†Ô∏è CRUCIAL: Un borrador de denuncia oficial contra "alto funcionario policial por encubrimiento y corrupci√≥n". No especifica el nombre, pero menciona "casos archivados de Los Verdes".' },
                    'financial_records': { name: 'Registros Financieros', description: 'El funcionario ten√≠a acceso a auditor√≠as internas. Estaba investigando transferencias sospechosas.' },
                    'threatening_note': { name: 'Nota Amenazante', description: '‚ö†Ô∏è CRUCIAL: Una nota sin firmar: "Mant√©n la boca cerrada o tu familia pagar√°. Sabes demasiado." Recibida hace 2 semanas.' },
                    'last_calls': { name: '√öltimas Llamadas', description: 'Su √∫ltima llamada fue al departamento de asuntos internos. Dur√≥ 3 minutos.' },
                    'deleted_messages': { name: 'Mensajes Eliminados', description: '‚ö†Ô∏è CRUCIAL: Mensajes eliminados pero recuperables: "Tengo evidencia contra el Capit√°n Rodr√≠guez. Ma√±ana presento la denuncia."' },
                    'anonymous_contact': { name: 'Contacto An√≥nimo', description: 'Recibi√≥ varias llamadas de un n√∫mero bloqueado los d√≠as previos a su muerte.' },
                    'camera_disabled': { name: 'C√°maras Desactivadas', description: '‚ö†Ô∏è CRUCIAL: Las c√°maras del piso fueron "desactivadas por mantenimiento" exactamente durante el horario del asesinato. Requiere acceso administrativo.' },
                    'access_log': { name: 'Registro de Acceso', description: 'Solo 4 personas ten√≠an acceso al piso esa noche: el funcionario, el guardia de turno, y dos oficiales de alto rango.' },
                    'timing_suspicious': { name: 'Timing Sospechoso', description: '‚ö†Ô∏è CRUCIAL: El caso fue archivado en menos de 24 horas como "suicidio". Firmado por el Capit√°n Rodr√≠guez. Ninguna investigaci√≥n profunda.' }
                },
                suspects: [
                    {
                        id: 'secretary',
                        name: 'Laura M√©ndez',
                        role: 'Secretaria del Funcionario',
                        avatar: 'üë©‚Äçüíº',
                        guilty: false,
                        questions: {
                            whereabouts: 'Me fui a las 6 PM, como siempre. No estaba aqu√≠ cuando pas√≥.',
                            relationship: 'Trabajaba para √©l hace 5 a√±os. Era un buen hombre, muy correcto.',
                            knowledge: 'S√© que estaba investigando algo. Parec√≠a preocupado √∫ltimamente, pero no me contaba detalles.'
                        },
                        clueReveals: {
                            draft_complaint: 'Dios m√≠o... ¬øiba a denunciar a alguien? Nunca me dijo nada espec√≠fico, pero notaba que ten√≠a miedo.',
                            threatening_note: '√âl nunca me mostr√≥ esto. Si hubiera sabido que su vida estaba en peligro...'
                        }
                    },
                    {
                        id: 'rival',
                        name: 'Fiscal Carlos Vega',
                        role: 'Rival Pol√≠tico',
                        avatar: 'üë®‚Äç‚öñÔ∏è',
                        guilty: false,
                        questions: {
                            whereabouts: 'Estaba en mi casa. Tengo coartada. Mi esposa y vecinos me vieron.',
                            relationship: 'Ten√≠amos diferencias profesionales, s√≠. Pero jam√°s le har√≠a da√±o. √âramos competidores, no enemigos.',
                            motive: '¬øYo matarlo? Es absurdo. Su muerte no me beneficia en nada.'
                        },
                        clueReveals: {
                            draft_complaint: '√âl me contact√≥ hace un mes. Me dijo que ten√≠a informaci√≥n sobre corrupci√≥n policial. Le dije que necesitaba evidencia s√≥lida.',
                            deleted_messages: 'Capit√°n Rodr√≠guez... Dios. Si esto es cierto, es m√°s grande de lo que pens√©.'
                        }
                    },
                    {
                        id: 'guard',
                        name: 'Guardia Tom√°s Ruiz',
                        role: 'Guardia de Seguridad Nocturno',
                        avatar: 'üëÆ‚Äç‚ôÇÔ∏è',
                        guilty: false,
                        questions: {
                            whereabouts: 'Estaba en mi puesto. Vi al funcionario entrar a las 8 PM. No sali√≥ despu√©s de eso.',
                            suspicious: 'No vi a nadie m√°s entrar. La puerta estaba cerrada desde dentro cuando lo encontramos.',
                            cameras: 'Las c√°maras... s√≠, estaban en "mantenimiento". Me avisaron por radio esa tarde.'
                        },
                        clueReveals: {
                            camera_disabled: 'Yo solo recib√≠ la orden. Vino desde arriba, desde administraci√≥n del departamento.',
                            access_log: 'Solo nosotros ten√≠amos acceso esa noche. Pero... alguien con autoridad podr√≠a haber entrado sin registrarse.'
                        }
                    }
                ],
                conclusions: [
                    {
                        id: 'suicide',
                        text: 'Fue suicidio. El funcionario se quit√≥ la vida por presi√≥n laboral.',
                        correct: false,
                        explanation: 'Las amenazas, el borrador de denuncia, las c√°maras desactivadas y el caso archivado en 24 horas demuestran claramente que fue asesinato.'
                    },
                    {
                        id: 'rival_killed',
                        text: 'El Fiscal Carlos Vega lo asesin√≥ por rivalidad pol√≠tica.',
                        correct: false,
                        explanation: 'Vega tiene coartada s√≥lida y no ten√≠a motivo real. La rivalidad era profesional, no mortal. Adem√°s, no tiene autoridad para desactivar c√°maras policiales.'
                    },
                    {
                        id: 'verdes_hitman',
                        text: 'Los Verdes enviaron un sicario para silenciarlo.',
                        correct: false,
                        explanation: 'Aunque Los Verdes est√°n involucrados, un sicario externo no podr√≠a desactivar c√°maras del departamento ni archivar el caso tan r√°pido. Fue alguien interno.'
                    },
                    {
                        id: 'captain_ordered',
                        text: 'El asesinato fue ordenado/ejecutado por alguien con poder dentro del departamento para protegerse.',
                        correct: true,
                        explanation: '¬°Correcto! El funcionario iba a denunciar al Capit√°n Rodr√≠guez. Las c√°maras fueron desactivadas con acceso administrativo, y el caso fue archivado en 24 horas por el mismo Capit√°n. Fue un asesinato para silenciarlo y proteger la corrupci√≥n.'
                    }
                ],
                targetQuestion: [
                    {
                        id: 'secretary',
                        text: 'La secretaria Laura M√©ndez',
                        correct: false,
                        explanation: 'Laura no ten√≠a motivo, no ten√≠a acceso para desactivar c√°maras, y no pod√≠a archivar el caso. Es completamente inocente.'
                    },
                    {
                        id: 'rival',
                        text: 'El Fiscal Carlos Vega',
                        correct: false,
                        explanation: 'Vega tiene coartada, no controla el departamento de polic√≠a, y no podr√≠a archivar el caso tan r√°pido. Es inocente.'
                    },
                    {
                        id: 'guard',
                        text: 'El Guardia Tom√°s Ruiz',
                        correct: false,
                        explanation: 'Tom√°s es un simple guardia. No tiene autoridad para desactivar c√°maras ni archivar casos. Solo segu√≠a √≥rdenes. Es inocente.'
                    },
                    {
                        id: 'captain',
                        text: 'El Capit√°n Rodr√≠guez (mi jefe)',
                        correct: true,
                        explanation: '¬°Correcto! El funcionario iba a denunciar al Capit√°n Rodr√≠guez por corrupci√≥n. Rodr√≠guez ten√≠a: 1) Motivo (protegerse), 2) Medios (acceso para desactivar c√°maras), 3) Oportunidad (poder para entrar sin registro), 4) Encubrimiento (archiv√≥ el caso en 24 horas). Todas las pistas apuntan a √©l.'
                    }
                ]
            }
        };

        // Referencia a la misi√≥n actual
        let currentMissionData = null;

        // Funciones de renderizado
        function renderMainMenu() {
            const screen = document.getElementById('game-screen');
            screen.innerHTML = `
                <div class="intro-screen" style="text-align: center; padding: 40px 20px;">
                    <div style="margin-bottom: 40px;">
                        <h1 style="font-size: 3.5em; color: #2c3e50; margin-bottom: 10px; text-shadow: 3px 3px 6px rgba(0,0,0,0.2);">
                            üïµÔ∏è LA SOMBRA DE JALEJOS
                        </h1>
                        <p style="font-size: 1.3em; color: #7f8c8d; font-style: italic;">
                            Los secretos m√°s oscuros se esconden en las calles
                        </p>
                    </div>
                    
                    <div style="max-width: 600px; margin: 0 auto;">
                        <div class="story-text" style="text-align: left; margin-bottom: 30px;">
                            <p style="font-size: 1.1em; line-height: 1.8;">
                                Eres <strong>Hugo L.</strong>, un detective experimentado que trabaja en los casos 
                                m√°s dif√≠ciles de la ciudad. Hace tres a√±os, tu hijo Miguel muri√≥ en un tiroteo de pandillas. 
                                Desde entonces, has dedicado tu vida a limpiar las calles.
                            </p>
                            <p style="margin-top: 15px; font-size: 1.1em;">
                                Las sombras esconden verdades que otros no se atreven a descubrir. Tu reputaci√≥n est√° en juego.
                            </p>
                        </div>
                        
                        <div style="background: white; padding: 25px; border-radius: 10px; margin-bottom: 20px; box-shadow: 0 4px 15px rgba(0,0,0,0.1);">
                            <h3 style="color: #e67e22; margin-bottom: 15px;">üìã Selecciona tu Misi√≥n</h3>
                            <button class="button" onclick="startMission1()" style="width: 100%; margin-bottom: 15px;">
                                üî™ Misi√≥n 1: El Asesinato del Callej√≥n Oscuro
                            </button>
                            <button class="button" onclick="${gameState.mission1Completed ? 'startMission2()' : 'alert(\'Primero debes completar la Misi√≥n 1\')'}" 
                                    style="width: 100%; margin-bottom: 15px; ${!gameState.mission1Completed ? 'opacity: 0.6; cursor: not-allowed;' : ''}" 
                                    id="mission2-btn">
                                üë®‚Äçüë©‚Äçüëß‚Äçüë¶ Misi√≥n 2: La Familia Desaparecida
                                ${!gameState.mission1Completed ? '<span style="display: block; font-size: 0.85em; margin-top: 5px;">üîí Bloqueada</span>' : ''}
                            </button>
                            <button class="button" onclick="${gameState.mission2Completed ? 'startMission3()' : 'alert(\'Primero debes completar la Misi√≥n 2\')'}" 
                                    style="width: 100%; margin-bottom: 15px; ${!gameState.mission2Completed ? 'opacity: 0.6; cursor: not-allowed;' : ''}" 
                                    id="mission3-btn">
                                üíÄ Misi√≥n 3: El Informante Silenciado
                                ${!gameState.mission2Completed ? '<span style="display: block; font-size: 0.85em; margin-top: 5px;">üîí Bloqueada</span>' : ''}
                            </button>
                            <button class="button" onclick="${gameState.mission3Completed ? 'startMission4()' : 'alert(\'Primero debes completar la Misi√≥n 3\')'}" 
                                    style="width: 100%; margin-bottom: 15px; background: linear-gradient(135deg, #8e44ad 0%, #6c3483 100%); ${!gameState.mission3Completed ? 'opacity: 0.6; cursor: not-allowed;' : ''}" 
                                    id="mission4-btn">
                                üîê Misi√≥n 4: Archivos Clasificados
                                <span style="display: block; font-size: 0.85em; margin-top: 5px;">‚ö†Ô∏è Misi√≥n Privada de Hugo</span>
                                ${!gameState.mission3Completed ? '<span style="display: block; font-size: 0.85em; margin-top: 5px;">üîí Bloqueada</span>' : ''}
                            </button>
                            <button class="button" onclick="${gameState.mission4Completed ? 'startMission5()' : 'alert(\'Primero debes completar la Misi√≥n 4\')'}" 
                                    style="width: 100%; background: linear-gradient(135deg, #c0392b 0%, #8e2a1f 100%); ${!gameState.mission4Completed ? 'opacity: 0.6; cursor: not-allowed;' : ''}" 
                                    id="mission5-btn">
                                ‚öñÔ∏è Misi√≥n 5: El Funcionario Silenciado
                                <span style="display: block; font-size: 0.85em; margin-top: 5px;">üî• La Verdad al Descubierto</span>
                                ${!gameState.mission4Completed ? '<span style="display: block; font-size: 0.85em; margin-top: 5px;">üîí Bloqueada</span>' : ''}
                            </button>
                        </div>
                        
                        <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; font-size: 0.9em; color: #555; margin-bottom: 15px;">
                            <strong>üí° Consejo:</strong> Lee todas las pistas cuidadosamente. Los detalles importan.
                        </div>

                        <div style="text-align: center;">
                            <button class="button button-secondary" onclick="resetProgress()" style="font-size: 0.9em; padding: 10px 20px;">
                                üîÑ Reiniciar Progreso
                            </button>
                        </div>
                    </div>
                </div>
            `;
        }

        function renderIntro() {
            const screen = document.getElementById('game-screen');
            screen.innerHTML = `
                <div class="intro-screen">
                    <div class="story-text">
                        <h2 style="color: #e67e22; margin-bottom: 15px;">üîç El Asesinato del Callej√≥n Oscuro</h2>
                        <p style="margin-bottom: 15px;">
                            <strong>11:30 PM - Callej√≥n del Distrito Este</strong>
                        </p>
                        <p style="margin-bottom: 15px;">
                            Un vagabundo ha sido encontrado muerto en un oscuro callej√≥n. La escena sugiere un robo que sali√≥ mal: 
                            cartera vac√≠a, signos de violencia, y el cuerpo abandonado sin piedad. Otro caso m√°s de la cruel realidad 
                            de las calles...
                        </p>
                        <p style="margin-bottom: 15px;">
                            Pero algo no cuadra. Las heridas son demasiado precisas, demasiado calculadas para ser un simple robo. 
                            Y luego est√° ese extra√±o s√≠mbolo verde en la pared...
                        </p>
                        <p style="margin-bottom: 0;">
                            Tu misi√≥n: <strong>Descubre la verdad detr√°s de este asesinato. ¬øFue realmente un robo que sali√≥ mal, 
                            o hay algo mucho m√°s oscuro detr√°s?</strong>
                        </p>
                    </div>
                    <div style="text-align: center;">
                        <button class="button" onclick="startGame()">üéÆ Comenzar Investigaci√≥n</button>
                    </div>
                </div>
            `;
        }

        function renderIntroMission2() {
            const screen = document.getElementById('game-screen');
            screen.innerHTML = `
                <div class="intro-screen">
                    <div class="story-text">
                        <h2 style="color: #e67e22; margin-bottom: 15px;">üë®‚Äçüë©‚Äçüëß‚Äçüë¶ La Familia Desaparecida</h2>
                        <p style="margin-bottom: 15px;">
                            <strong>8:00 AM - Residencia de la Familia Ram√≠rez</strong>
                        </p>
                        <p style="margin-bottom: 15px;">
                            Los vecinos reportaron que la familia Ram√≠rez no ha sido vista en 24 horas. Al entrar a la casa, 
                            encuentras una escena desconcertante: todo est√° intacto, la comida todav√≠a est√° fresca, el televisor 
                            encendido... pero no hay rastro de la familia.
                        </p>
                        <p style="margin-bottom: 15px;">
                            No hay signos de violencia. No hay signos de robo. Simplemente... desaparecieron.
                        </p>
                        <p style="margin-bottom: 15px; padding: 15px; background: #fff3cd; border-left: 4px solid #ffc107; border-radius: 5px;">
                            <strong>‚ö†Ô∏è ADVERTENCIA:</strong> Esta misi√≥n no tiene sospechosos. Debes llegar a la conclusi√≥n correcta 
                            bas√°ndote √∫nicamente en las pistas. <strong style="color: #dc3545;">Si fallas, ser√°s despedido del cuerpo 
                            de detectives.</strong>
                        </p>
                        <p style="margin-bottom: 0;">
                            Tu primera impresi√≥n, detective Hugo L.: <em>"Parece que huyeron tras ser amenazados... 
                            pero necesito pruebas para confirmarlo."</em>
                        </p>
                    </div>
                    <div style="text-align: center;">
                        <button class="button" onclick="startGameMission2()">üéÆ Comenzar Investigaci√≥n</button>
                    </div>
                </div>
            `;
        }

        function renderIntroMission3() {
            const screen = document.getElementById('game-screen');
            screen.innerHTML = `
                <div class="intro-screen">
                    <div class="story-text">
                        <h2 style="color: #e67e22; margin-bottom: 15px;">üíÄ El Informante Silenciado</h2>
                        <p style="margin-bottom: 15px;">
                            <strong>3:45 AM - Casa de Seguridad Policial</strong>
                        </p>
                        <p style="margin-bottom: 15px;">
                            Recibes la llamada que todo detective teme: un informante clave contra Los Verdes ha sido asesinado. 
                            Deb√≠a testificar ma√±ana en el juicio m√°s importante del a√±o. Estaba en una casa de seguridad, 
                            ubicaci√≥n clasificada, conocida solo por un pu√±ado de personas de confianza.
                        </p>
                        <p style="margin-bottom: 15px;">
                            Al llegar a la escena, todo apunta a una ejecuci√≥n profesional. Un disparo limpio, sin testigos, 
                            sin lucha. Las c√°maras de seguridad "casualmente" fallaron durante el ataque.
                        </p>
                        <p style="margin-bottom: 15px; padding: 15px; background: #f8d7da; border-left: 4px solid #dc3545; border-radius: 5px;">
                            <strong>‚ö†Ô∏è CASO ALTAMENTE SENSIBLE:</strong> Solo hay 2 sospechosos disponibles para interrogar. 
                            Las pistas son escasas y ambiguas. Debes sacar la conclusi√≥n correcta sobre lo que realmente pas√≥ 
                            Y identificar al responsable. <strong style="color: #dc3545;">Si fallas en cualquiera de las dos 
                            preguntas, ser√°s despedido.</strong>
                        </p>
                        <p style="margin-bottom: 15px; padding: 15px; background: #d4edda; border-left: 4px solid #28a745; border-radius: 5px;">
                            El Capit√°n Rodr√≠guez te llama aparte: <em>"Hugo, s√© que perdiste a Miguel por culpa de estas pandillas. 
                            S√© lo que significa esto para ti. Pero necesito que mantengas la cabeza fr√≠a. Este caso... podr√≠a 
                            ser m√°s peligroso de lo que imaginas. Ten cuidado en qui√©n conf√≠as."</em>
                        </p>
                        <p style="margin-bottom: 0;">
                            Algo no est√° bien. Muy arriba. Y est√°s a punto de descubrirlo.
                        </p>
                    </div>
                    <div style="text-align: center;">
                        <button class="button" onclick="startGameMission3()">üéÆ Comenzar Investigaci√≥n</button>
                    </div>
                </div>
            `;
        }

        function renderMission4Unlock() {
            const screen = document.getElementById('game-screen');
            screen.innerHTML = `
                <div class="end-screen">
                    <div class="story-text" style="max-width: 700px; margin: 0 auto;">
                        <h2 style="color: #8e44ad; margin-bottom: 20px; text-align: center;">üîê Misi√≥n Desbloqueada</h2>
                        
                        <div style="background: #2c3e50; color: white; padding: 25px; border-radius: 10px; margin-bottom: 20px; box-shadow: 0 4px 15px rgba(0,0,0,0.3);">
                            <h3 style="color: #ecf0f1; margin-bottom: 15px; text-align: center;">‚ö†Ô∏è MISI√ìN PRIVADA ‚ö†Ô∏è</h3>
                            <p style="margin-bottom: 15px; font-style: italic;">
                                2:30 AM - Tres d√≠as despu√©s del caso del informante
                            </p>
                            <p style="margin-bottom: 15px;">
                                No puedes sac√°rtelo de la cabeza. Alguien con acceso privilegiado est√° protegiendo a Los Verdes. 
                                Los casos se archivan misteriosamente. Los informantes mueren. Las evidencias desaparecen.
                            </p>
                            <p style="margin-bottom: 15px;">
                                <strong>¬øY si la respuesta est√° en los archivos del departamento?</strong>
                            </p>
                            <p style="margin-bottom: 15px; padding: 15px; background: rgba(231, 76, 60, 0.2); border-left: 4px solid #e74c3c; border-radius: 5px;">
                                Esta no es una misi√≥n oficial. Nadie puede saber lo que est√°s a punto de hacer. 
                                Si te descubren, tu carrera termina. Pero si no act√∫as... Los Verdes ganan.
                            </p>
                            <p style="margin-bottom: 0; font-style: italic; text-align: center;">
                                <em>"Por Miguel... tengo que descubrir la verdad."</em>
                            </p>
                        </div>
                        
                        <div style="text-align: center;">
                            <button class="button" style="background: linear-gradient(135deg, #8e44ad 0%, #6c3483 100%);" onclick="startMission4()">
                                üåô Comenzar Misi√≥n Nocturna
                            </button>
                            <button class="button button-secondary" onclick="location.reload()">üè† Volver al Men√∫</button>
                        </div>
                    </div>
                </div>
            `;
        }

        function renderMission5Unlock() {
            const screen = document.getElementById('game-screen');
            screen.innerHTML = `
                <div class="end-screen">
                    <div class="story-text" style="max-width: 700px; margin: 0 auto;">
                        <h2 style="color: #c0392b; margin-bottom: 20px; text-align: center;">üî• Nueva Misi√≥n Desbloqueada</h2>
                        
                        <div style="background: #2c3e50; color: white; padding: 25px; border-radius: 10px; margin-bottom: 20px; box-shadow: 0 4px 15px rgba(0,0,0,0.3);">
                            <h3 style="color: #e74c3c; margin-bottom: 15px; text-align: center;">‚ö†Ô∏è CASO ARCHIVADO ‚ö†Ô∏è</h3>
                            <p style="margin-bottom: 15px; font-style: italic;">
                                La llamada an√≥nima te dio una pista. El funcionario Eduardo Garc√≠a, del departamento de 
                                auditor√≠a interna, fue encontrado muerto en su oficina hace un mes.
                            </p>
                            <p style="margin-bottom: 15px;">
                                <strong>Causa oficial: Suicidio.</strong>
                            </p>
                            <p style="margin-bottom: 15px;">
                                Pero seg√∫n tu fuente an√≥nima, Garc√≠a estaba a punto de presentar una denuncia formal contra 
                                alguien de alto rango. El caso fue archivado en menos de 24 horas.
                            </p>
                            <p style="margin-bottom: 15px; padding: 15px; background: rgba(231, 76, 60, 0.2); border-left: 4px solid #e74c3c; border-radius: 5px;">
                                <strong>Tu misi√≥n:</strong> Investiga oficialmente el caso como "revisi√≥n rutinaria". 
                                Descubre a qui√©n iba a denunciar Garc√≠a y qu√© pas√≥ realmente. Pero ten cuidado... 
                                si el asesino descubre que est√°s cerca de la verdad, podr√≠as ser el siguiente.
                            </p>
                            <p style="margin-bottom: 0; font-style: italic; text-align: center; color: #e74c3c; font-weight: bold;">
                                "Por Javier. Por Miguel. Por Garc√≠a. Esta termina ahora."
                            </p>
                        </div>
                        
                        <div style="text-align: center;">
                            <button class="button" style="background: linear-gradient(135deg, #c0392b 0%, #8e2a1f 100%);" onclick="startMission5()">
                                üîç Reabrir el Caso Garc√≠a
                            </button>
                            <button class="button button-secondary" onclick="location.reload()">üè† Volver al Men√∫</button>
                        </div>
                    </div>
                </div>
            `;
        }

        function renderIntroMission5() {
            const screen = document.getElementById('game-screen');
            screen.innerHTML = `
                <div class="intro-screen">
                    <div class="story-text">
                        <h2 style="color: #c0392b; margin-bottom: 15px;">‚öñÔ∏è El Funcionario Silenciado</h2>
                        <p style="margin-bottom: 15px;">
                            <strong>9:00 AM - Oficina de Eduardo Garc√≠a (Escena del Crimen)</strong>
                        </p>
                        <p style="margin-bottom: 15px;">
                            Oficialmente, est√°s aqu√≠ para una "revisi√≥n rutinaria" del caso. Nadie sospecha tus verdaderas 
                            intenciones. Eduardo Garc√≠a, 47 a√±os, auditor interno del departamento, fue encontrado muerto 
                            con un disparo en la cabeza en su oficina.
                        </p>
                        <p style="margin-bottom: 15px;">
                            La escena fue clasificada como suicidio. La puerta estaba cerrada desde dentro. El arma estaba 
                            en su mano. Caso cerrado en 24 horas.
                        </p>
                        <p style="margin-bottom: 15px; padding: 15px; background: #fff3cd; border-left: 4px solid #ffc107; border-radius: 5px;">
                            <strong>‚ö†Ô∏è MISI√ìN DUAL:</strong><br>
                            1. Investiga el asesinato (hay 3 sospechosos, todos inocentes pero parecen culpables)<br>
                            2. Descubre a qui√©n iba a denunciar Garc√≠a<br>
                            <strong style="color: #dc3545;">Debes acertar AMBAS conclusiones o ser√°s despedido.</strong>
                        </p>
                        <p style="margin-bottom: 15px; padding: 15px; background: #d4edda; border-left: 4px solid #28a745; border-radius: 5px;">
                            Tu instinto de detective te dice: <em>"Esto NO fue suicidio. Y si descubro que era mi jefe 
                            a quien iba a denunciar... tendr√© que tomar una decisi√≥n que cambiar√° todo."</em>
                        </p>
                        <p style="margin-bottom: 0;">
                            Las pistas est√°n esperando. La verdad est√° cerca. ¬øEst√°s listo para descubrirla?
                        </p>
                    </div>
                    <div style="text-align: center;">
                        <button class="button" style="background: linear-gradient(135deg, #c0392b 0%, #8e2a1f 100%);" onclick="startGameMission5()">
                            üéÆ Comenzar Investigaci√≥n
                        </button>
                    </div>
                </div>
            `;
        }

        function renderIntroMission4() {
            const screen = document.getElementById('game-screen');
            screen.innerHTML = `
                <div class="intro-screen">
                    <div class="story-text">
                        <h2 style="color: #8e44ad; margin-bottom: 15px;">üîê Archivos Clasificados</h2>
                        <p style="margin-bottom: 15px;">
                            <strong>2:45 AM - Estaci√≥n de Polic√≠a (Sala de Archivos)</strong>
                        </p>
                        <p style="margin-bottom: 15px;">
                            Usaste tu tarjeta de acceso para entrar al edificio. Oficialmente, viniste a recoger unos documentos. 
                            Pero tu verdadero objetivo est√° en el s√≥tano: <strong>la sala de casos archivados</strong>.
                        </p>
                        <p style="margin-bottom: 15px;">
                            Hay guardias de seguridad patrullando. Debes ser cauteloso. Revisar los archivos equivocados podr√≠a 
                            levantar sospechas. Y si te descubren en esta misi√≥n no autorizada...
                        </p>
                        <p style="margin-bottom: 15px; padding: 15px; background: #fff3cd; border-left: 4px solid #ffc107; border-radius: 5px;">
                            <strong>‚ö†Ô∏è MEC√ÅNICAS ESPECIALES:</strong><br>
                            ‚Ä¢ Debes revisar archivos para encontrar patrones sospechosos<br>
                            ‚Ä¢ Algunos archivos levantan M√ÅS sospecha que otros<br>
                            ‚Ä¢ Si la sospecha es muy alta, los guardias te detectar√°n<br>
                            ‚Ä¢ Debes llegar a la conclusi√≥n correcta sobre las inconsistencias<br>
                            ‚Ä¢ Al final, alguien ser√° culpado por la intrusi√≥n...
                        </p>
                        <p style="margin-bottom: 0; padding: 15px; background: #f8d7da; border-left: 4px solid #dc3545; border-radius: 5px;">
                            <strong style="color: #dc3545;">DECISI√ìN CR√çTICA:</strong> Cuando te descubran que alguien revis√≥ 
                            los archivos, tendr√°s que decidir si confesar que fuiste t√∫ o dejar que sospechen de un compa√±ero 
                            inocente. Esta decisi√≥n tendr√° consecuencias fatales.
                        </p>
                    </div>
                    <div style="text-align: center;">
                        <button class="button" style="background: linear-gradient(135deg, #8e44ad 0%, #6c3483 100%);" onclick="startGameMission4()">
                            üî¶ Entrar a la Sala de Archivos
                        </button>
                    </div>
                </div>
            `;
        }

        function renderLocationSelect() {
            const screen = document.getElementById('game-screen');
            const visitedLocations = gameState.cluesFound.map(c => {
                for (let loc of currentMissionData.locations) {
                    if (loc.clues.includes(c)) return loc.id;
                }
            });

            let locationsHTML = currentMissionData.locations.map(loc => {
                const visited = visitedLocations.includes(loc.id);
                return `
                    <div class="location-card ${visited ? 'visited' : ''}" onclick="exploreLocation('${loc.id}')">
                        <div class="location-icon">${loc.icon}</div>
                        <div class="location-name">${loc.name}</div>
                        ${visited ? '<div class="badge">Visitado</div>' : ''}
                    </div>
                `;
            }).join('');

            const totalClues = gameState.currentMission === 1 ? 9 : (gameState.currentMission === 2 ? 12 : (gameState.currentMission === 3 ? 9 : 12));
            const minClues = gameState.currentMission === 1 ? 4 : (gameState.currentMission === 2 ? 8 : (gameState.currentMission === 3 ? 6 : 8));
            
            // Botones de acci√≥n seg√∫n la misi√≥n
            let actionButtons = '';
            if (gameState.currentMission === 1) {
                actionButtons = `
                    <button class="button button-secondary" onclick="renderSuspectSelect()">üë• Interrogar Sospechosos</button>
                    ${gameState.cluesFound.length >= minClues ? '<button class="button" onclick="renderAccusation()">‚öñÔ∏è Hacer Acusaci√≥n</button>' : ''}
                `;
            } else if (gameState.currentMission === 2) {
                actionButtons = `
                    ${gameState.cluesFound.length >= minClues ? '<button class="button" onclick="renderConclusions()">üéØ Presentar Conclusi√≥n</button>' : ''}
                `;
            } else if (gameState.currentMission === 3) {
                actionButtons = `
                    <button class="button button-secondary" onclick="renderSuspectSelect()">üë• Interrogar Sospechosos</button>
                    ${gameState.cluesFound.length >= minClues ? '<button class="button" onclick="renderMission3Conclusions()">üéØ Presentar Conclusi√≥n Final</button>' : ''}
                `;
            } else if (gameState.currentMission === 5) {
                actionButtons = `
                    <button class="button button-secondary" onclick="renderSuspectSelect()">üë• Interrogar Sospechosos</button>
                    ${gameState.cluesFound.length >= minClues ? '<button class="button" style="background: linear-gradient(135deg, #c0392b 0%, #8e2a1f 100%);" onclick="renderMission5Conclusions()">üéØ Presentar Conclusi√≥n Final</button>' : ''}
                `;
            }

            screen.innerHTML = `
                <div class="location-screen">
                    <div class="story-text">
                        <h2 style="color: #e67e22; margin-bottom: 10px;">üìç Selecciona una Ubicaci√≥n</h2>
                        <p>Explora diferentes √°reas para encontrar pistas que te ayuden a resolver el caso.</p>
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: ${(gameState.cluesFound.length / totalClues) * 100}%"></div>
                        </div>
                    </div>
                    <div class="location-grid">
                        ${locationsHTML}
                    </div>
                    <div style="text-align: center; margin-top: 20px;">
                        ${actionButtons}
                    </div>
                    ${renderNotebook()}
                </div>
            `;
        }

        function exploreLocation(locationId) {
            const location = currentMissionData.locations.find(l => l.id === locationId);
            gameState.currentLocation = locationId;

            const cluesHTML = location.clues.map(clueId => {
                const clue = currentMissionData.clues[clueId];
                const found = gameState.cluesFound.includes(clueId);
                return `
                    <div class="clue-item ${found ? 'clue-found' : ''}" onclick="${!found ? `findClue('${clueId}')` : ''}">
                        <strong>${found ? '‚úÖ' : 'üîç'} ${clue.name}</strong>
                        ${found ? `<p style="margin-top: 8px; color: #555;">${clue.description}</p>` : ''}
                    </div>
                `;
            }).join('');

            const screen = document.getElementById('game-screen');
            screen.innerHTML = `
                <div class="location-screen">
                    <div class="story-text">
                        <h2 style="color: #e67e22;">${location.icon} ${location.name}</h2>
                        <p>Busca cuidadosamente en esta √°rea. Haz clic en las pistas para examinarlas.</p>
                    </div>
                    <div class="clue-search">
                        <h3 style="margin-bottom: 15px;">üîé Buscar Pistas</h3>
                        ${cluesHTML}
                    </div>
                    <div style="text-align: center;">
                        <button class="button button-secondary" onclick="renderLocationSelect()">‚¨ÖÔ∏è Volver a Ubicaciones</button>
                    </div>
                </div>
            `;
        }

        function findClue(clueId) {
            if (!gameState.cluesFound.includes(clueId)) {
                gameState.cluesFound.push(clueId);
                updateStats();
                exploreLocation(gameState.currentLocation);
            }
        }

        function renderSuspectSelect() {
            const screen = document.getElementById('game-screen');
            const suspectsHTML = currentMissionData.suspects.map(suspect => {
                const questioned = gameState.suspectsQuestioned.includes(suspect.id);
                return `
                    <div class="suspect-card ${questioned ? 'questioned' : ''}" onclick="interrogateSuspect('${suspect.id}')">
                        <div class="suspect-avatar">${suspect.avatar}</div>
                        <div class="suspect-name">${suspect.name}</div>
                        <div class="suspect-role">${suspect.role}</div>
                        ${questioned ? '<div class="badge">Interrogado</div>' : ''}
                    </div>
                `;
            }).join('');

            screen.innerHTML = `
                <div class="interrogation-screen">
                    <div class="story-text">
                        <h2 style="color: #e67e22; margin-bottom: 10px;">üë• Selecciona un Sospechoso</h2>
                        <p>Interroga a los sospechosos. Sus respuestas pueden revelar informaci√≥n crucial.</p>
                    </div>
                    <div class="suspect-grid">
                        ${suspectsHTML}
                    </div>
                    <div style="text-align: center; margin-top: 20px;">
                        <button class="button button-secondary" onclick="renderLocationSelect()">‚¨ÖÔ∏è Volver a Ubicaciones</button>
                    </div>
                    ${renderNotebook()}
                </div>
            `;
        }

        function interrogateSuspect(suspectId) {
            const suspect = currentMissionData.suspects.find(s => s.id === suspectId);
            gameState.currentSuspect = suspectId;

            if (!gameState.suspectsQuestioned.includes(suspectId)) {
                gameState.suspectsQuestioned.push(suspectId);
                updateStats();
            }

            const questionsHTML = Object.entries(suspect.questions).map(([key, answer]) => {
                return `
                    <button class="question-btn" onclick="askQuestion('${suspectId}', '${key}', \`${answer}\`)">
                        ${getQuestionText(key)}
                    </button>
                `;
            }).join('');

            // Revisar si hay pistas que revelan informaci√≥n adicional
            let clueRevealHTML = '';
            if (suspect.clueReveals) {
                for (let [clueId, reveal] of Object.entries(suspect.clueReveals)) {
                    if (gameState.cluesFound.includes(clueId)) {
                        clueRevealHTML += `
                            <div class="answer-box" style="background: #fff3cd; border-left-color: #ffc107;">
                                <strong>üí° Confrontando con: ${currentMissionData.clues[clueId].name}</strong>
                                <p style="margin-top: 8px;">"${reveal}"</p>
                            </div>
                        `;
                    }
                }
            }

            const screen = document.getElementById('game-screen');
            screen.innerHTML = `
                <div class="interrogation-screen">
                    <div class="story-text">
                        <h2 style="color: #e67e22;">${suspect.avatar} Interrogatorio: ${suspect.name}</h2>
                        <p><em>${suspect.role}</em></p>
                    </div>
                    <div class="question-box">
                        <h3 style="margin-bottom: 15px;">‚ùì Selecciona una Pregunta</h3>
                        <div class="question-options" id="question-area">
                            ${questionsHTML}
                        </div>
                        <div id="answer-area">${clueRevealHTML}</div>
                    </div>
                    <div style="text-align: center;">
                        <button class="button button-secondary" onclick="renderSuspectSelect()">‚¨ÖÔ∏è Volver a Sospechosos</button>
                    </div>
                </div>
            `;
        }

        function askQuestion(suspectId, questionKey, answer) {
            const answerArea = document.getElementById('answer-area');
            const newAnswer = `
                <div class="answer-box">
                    <strong>Respuesta:</strong>
                    <p style="margin-top: 8px;">"${answer}"</p>
                </div>
            `;
            answerArea.innerHTML = newAnswer + answerArea.innerHTML;
        }

        function getQuestionText(key) {
            const questions = {
                whereabouts: 'üìç ¬øD√≥nde estabas durante el robo?',
                motive: 'üí∞ ¬øTienes alg√∫n motivo para robar el diamante?',
                access: 'üîë ¬øTen√≠as acceso a la b√≥veda?'
            };
            return questions[key] || key;
        }

        function renderAccusation() {
            const screen = document.getElementById('game-screen');
            const suspectsHTML = currentMissionData.suspects.map(suspect => {
                return `
                    <button class="question-btn" onclick="makeAccusation('${suspect.id}')" style="text-align: center;">
                        ${suspect.avatar} ${suspect.name} - ${suspect.role}
                    </button>
                `;
            }).join('');

            screen.innerHTML = `
                <div class="end-screen">
                    <div class="accusation-panel">
                        <h2 style="color: #e67e22; margin-bottom: 15px;">‚öñÔ∏è Momento de la Verdad</h2>
                        <p style="margin-bottom: 20px;">
                            Has reunido suficiente informaci√≥n. Es hora de hacer tu acusaci√≥n.
                            <strong>¬°Elige con cuidado, solo tienes una oportunidad!</strong>
                        </p>
                        <h3 style="margin-bottom: 15px;">¬øQui√©n asesin√≥ al vagabundo?</h3>
                        ${suspectsHTML}
                    </div>
                    <div style="text-align: center; margin-top: 20px;">
                        <button class="button button-secondary" onclick="renderLocationSelect()">‚¨ÖÔ∏è Seguir Investigando</button>
                    </div>
                    ${renderNotebook()}
                </div>
            `;
        }

        function renderConclusions() {
            const screen = document.getElementById('game-screen');
            const conclusionsHTML = currentMissionData.conclusions.map(conclusion => {
                return `
                    <button class="question-btn" onclick="makeConclusion('${conclusion.id}')" style="text-align: center; padding: 20px;">
                        ${conclusion.text}
                    </button>
                `;
            }).join('');

            screen.innerHTML = `
                <div class="end-screen">
                    <div class="accusation-panel">
                        <h2 style="color: #e67e22; margin-bottom: 15px;">üéØ Momento de la Verdad</h2>
                        <p style="margin-bottom: 15px;">
                            Has reunido suficiente informaci√≥n sobre la desaparici√≥n de la familia Ram√≠rez.
                        </p>
                        <p style="margin-bottom: 20px; color: #dc3545; font-weight: bold;">
                            ‚ö†Ô∏è ADVERTENCIA: Solo tienes una oportunidad. Si te equivocas, ser√°s despedido.
                        </p>
                        <h3 style="margin-bottom: 15px;">¬øCu√°l es tu conclusi√≥n, Detective Hugo L.?</h3>
                        ${conclusionsHTML}
                    </div>
                    <div style="text-align: center; margin-top: 20px;">
                        <button class="button button-secondary" onclick="renderLocationSelect()">‚¨ÖÔ∏è Seguir Investigando</button>
                    </div>
                    ${renderNotebook()}
                </div>
            `;
        }

        function makeConclusion(conclusionId) {
            stopTimer();
            const conclusion = currentMissionData.conclusions.find(c => c.id === conclusionId);
            const correct = conclusion.correct;

            const screen = document.getElementById('game-screen');
            if (correct) {
                gameState.mission2Completed = true;
                saveProgress();
                screen.innerHTML = `
                    <div class="end-screen">
                        <div class="result-box result-success">
                            <h1 style="color: #28a745; margin-bottom: 20px;">‚úÖ ¬°CONCLUSI√ìN CORRECTA!</h1>
                            <div style="font-size: 5em; margin: 20px 0;">üéØ</div>
                            <h2 style="margin-bottom: 15px;">Excelente trabajo, Detective Hugo L.</h2>
                            <div class="story-text" style="text-align: left;">
                                <p style="margin-bottom: 15px;">
                                    <strong>Tu conclusi√≥n:</strong> ${conclusion.text}
                                </p>
                                <p style="margin-bottom: 20px; padding: 15px; background: #d4edda; border-left: 4px solid #28a745; border-radius: 5px;">
                                    ${conclusion.explanation}
                                </p>
                                <hr style="margin: 25px 0; border: none; border-top: 2px solid #e0e0e0;">
                                <p style="margin-bottom: 15px; font-style: italic; color: #555;">
                                    Apenas terminas de escribir tu informe cuando tu tel√©fono suena. 3:30 AM. Es el jefe, y suena preocupado...
                                </p>
                            </div>
                            <div style="margin-top: 25px;">
                                <button class="button" onclick="renderBossDialogue()">üìû Contestar Llamada</button>
                            </div>
                        </div>
                    </div>
                `;
            } else {
                screen.innerHTML = `
                    <div class="end-screen">
                        <div class="result-box result-failure">
                            <h1 style="color: #dc3545; margin-bottom: 20px;">‚ùå CONCLUSI√ìN INCORRECTA</h1>
                            <div style="font-size: 5em; margin: 20px 0;">üòû</div>
                            <h2 style="margin-bottom: 15px;">Has sido despedido, Hugo L.</h2>
                            <div class="story-text" style="text-align: left;">
                                <p style="margin-bottom: 15px;">
                                    <strong>Tu conclusi√≥n:</strong> ${conclusion.text}
                                </p>
                                <p style="margin-bottom: 15px; padding: 15px; background: #f8d7da; border-left: 4px solid #dc3545; border-radius: 5px;">
                                    <strong>Por qu√© estabas equivocado:</strong><br>
                                    ${conclusion.explanation}
                                </p>
                                <hr style="margin: 20px 0; border: none; border-top: 2px solid #e0e0e0;">
                                <p style="margin-bottom: 15px;">
                                    <strong style="color: #e67e22;">La conclusi√≥n correcta era:</strong><br>
                                    ${currentMissionData.conclusions.find(c => c.correct).text}
                                </p>
                                <p style="margin-bottom: 15px;">
                                    ${currentMissionData.conclusions.find(c => c.correct).explanation}
                                </p>
                                <hr style="margin: 20px 0; border: none; border-top: 2px solid #e0e0e0;">
                                <p style="font-style: italic; color: #555;">
                                    El jefe te llama a su oficina. "Hugo, lo siento pero tu placa y tu arma. 
                                    No podemos permitirnos este tipo de errores. Est√°s fuera."
                                </p>
                            </div>
                            <div style="margin-top: 25px;">
                                <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin-bottom: 15px;">
                                    <strong>Estad√≠sticas del Caso:</strong><br>
                                    üîç Pistas encontradas: ${gameState.cluesFound.length}/12<br>
                                    ‚è±Ô∏è Tiempo usado: ${formatTime(1500 - gameState.timeRemaining)}
                                </div>
                                <button class="button" onclick="location.reload()">üîÑ Volver al Men√∫</button>
                            </div>
                        </div>
                    </div>
                `;
            }
        }

        function renderMission3Conclusions() {
            const screen = document.getElementById('game-screen');
            const conclusionsHTML = currentMissionData.conclusions.map(conclusion => {
                return `
                    <button class="question-btn" onclick="saveMission3Conclusion('${conclusion.id}')" style="text-align: center; padding: 20px;">
                        ${conclusion.text}
                    </button>
                `;
            }).join('');

            screen.innerHTML = `
                <div class="end-screen">
                    <div class="accusation-panel">
                        <h2 style="color: #e67e22; margin-bottom: 15px;">üéØ Parte 1: ¬øQu√© Pas√≥ Realmente?</h2>
                        <p style="margin-bottom: 15px;">
                            Has investigado el asesinato del informante. Ahora debes responder dos preguntas cruciales.
                        </p>
                        <p style="margin-bottom: 20px; color: #dc3545; font-weight: bold;">
                            ‚ö†Ô∏è ADVERTENCIA: Debes acertar AMBAS preguntas. Si fallas cualquiera de las dos, ser√°s despedido.
                        </p>
                        <h3 style="margin-bottom: 15px;">Primera Pregunta: ¬øCu√°l es la conclusi√≥n correcta sobre lo que ocurri√≥?</h3>
                        ${conclusionsHTML}
                    </div>
                    <div style="text-align: center; margin-top: 20px;">
                        <button class="button button-secondary" onclick="renderLocationSelect()">‚¨ÖÔ∏è Seguir Investigando</button>
                    </div>
                    ${renderNotebook()}
                </div>
            `;
        }

        let mission3SelectedConclusion = null;

        function saveMission3Conclusion(conclusionId) {
            mission3SelectedConclusion = conclusionId;
            renderMission3KillerSelect();
        }

        function renderMission3KillerSelect() {
            const screen = document.getElementById('game-screen');
            const killersHTML = currentMissionData.killerOptions.map(killer => {
                return `
                    <button class="question-btn" onclick="makeMission3FinalAnswer('${killer.id}')" style="text-align: center; padding: 20px;">
                        ${killer.name}
                    </button>
                `;
            }).join('');

            screen.innerHTML = `
                <div class="end-screen">
                    <div class="accusation-panel">
                        <h2 style="color: #e67e22; margin-bottom: 15px;">üéØ Parte 2: ¬øQui√©n es el Responsable?</h2>
                        <p style="margin-bottom: 15px;">
                            Has determinado lo que pas√≥. Ahora identifica qui√©n es el verdadero responsable del asesinato.
                        </p>
                        <p style="margin-bottom: 20px; color: #dc3545; font-weight: bold;">
                            ‚ö†Ô∏è Esta es tu decisi√≥n final. No hay vuelta atr√°s.
                        </p>
                        <h3 style="margin-bottom: 15px;">Segunda Pregunta: ¬øQui√©n mat√≥ al informante?</h3>
                        ${killersHTML}
                    </div>
                    <div style="text-align: center; margin-top: 20px;">
                        <button class="button button-secondary" onclick="renderMission3Conclusions()">‚¨ÖÔ∏è Cambiar Conclusi√≥n</button>
                    </div>
                    ${renderNotebook()}
                </div>
            `;
        }

        function makeMission3FinalAnswer(killerId) {
            stopTimer();
            const conclusion = currentMissionData.conclusions.find(c => c.id === mission3SelectedConclusion);
            const killer = currentMissionData.killerOptions.find(k => k.id === killerId);
            
            const conclusionCorrect = conclusion.correct;
            const killerCorrect = killer.correct;
            const bothCorrect = conclusionCorrect && killerCorrect;

            const screen = document.getElementById('game-screen');
            
            if (bothCorrect) {
                gameState.mission3Completed = true;
                saveProgress();
                screen.innerHTML = `
                    <div class="end-screen">
                        <div class="result-box result-success">
                            <h1 style="color: #28a745; margin-bottom: 20px;">‚úÖ ¬°CASO RESUELTO!</h1>
                            <div style="font-size: 5em; margin: 20px 0;">üéØ</div>
                            <h2 style="margin-bottom: 15px;">Has descubierto la verdad, Detective Hugo L.</h2>
                            <div class="story-text" style="text-align: left;">
                                <h3 style="color: #e67e22; margin-bottom: 15px;">Tus Conclusiones:</h3>
                                <div style="background: #d4edda; padding: 15px; border-left: 4px solid #28a745; border-radius: 5px; margin-bottom: 15px;">
                                    <strong>¬øQu√© pas√≥?</strong><br>
                                    ${conclusion.text}<br><br>
                                    ${conclusion.explanation}
                                </div>
                                <div style="background: #d4edda; padding: 15px; border-left: 4px solid #28a745; border-radius: 5px; margin-bottom: 20px;">
                                    <strong>¬øQui√©n es el responsable?</strong><br>
                                    ${killer.name}<br><br>
                                    ${killer.explanation}
                                </div>
                                <hr style="margin: 25px 0; border: none; border-top: 2px solid #e0e0e0;">
                                <div style="background: #fff3cd; padding: 20px; border-left: 4px solid #ffc107; border-radius: 5px; margin-bottom: 20px;">
                                    <h3 style="color: #e67e22; margin-bottom: 10px;">La Verdad Revelada</h3>
                                    <p style="margin-bottom: 15px;">
                                        Has descubierto algo que cambiar√° todo: <strong>Los Verdes tienen protecci√≥n desde dentro 
                                        de las instituciones.</strong> Alguien con poder real est√° en su n√≥mina.
                                    </p>
                                    <p style="margin-bottom: 15px;">
                                        El Capit√°n Rodr√≠guez lee tu informe con expresi√≥n sombr√≠a. "Hugo... esto es m√°s grave de lo 
                                        que imagin√©. Si esto se filtra a las personas equivocadas... ambos estamos muertos."
                                    </p>
                                    <p style="margin-bottom: 15px;">
                                        "Necesitamos m√°s evidencia antes de mover ficha. Pero ahora sabemos que no estamos luchando 
                                        solo contra una pandilla. Estamos luchando contra el sistema mismo."
                                    </p>
                                    <p style="font-style: italic; color: #555; margin-top: 20px;">
                                        Esa noche, no puedes dormir. Las palabras del Capit√°n resuenan en tu mente. <em>"Necesitamos 
                                        m√°s evidencia..."</em> ¬øQu√© tal si esa evidencia est√° justo bajo sus narices? En los archivos 
                                        del departamento...
                                    </p>
                                </div>
                                <p style="font-style: italic; text-align: center; color: #555;">
                                    Una idea peligrosa comienza a formarse. Una misi√≥n que nadie puede saber...<br>
                                    Miguel estar√≠a orgulloso de tu valent√≠a, Hugo. Pero tambi√©n preocupado por tu seguridad.
                                </p>
                            </div>
                            <div style="margin-top: 25px;">
                                <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin-bottom: 15px;">
                                    <strong>Estad√≠sticas del Caso:</strong><br>
                                    üîç Pistas encontradas: ${gameState.cluesFound.length}/9<br>
                                    üë• Sospechosos interrogados: ${gameState.suspectsQuestioned.length}/2<br>
                                    ‚è±Ô∏è Tiempo usado: ${formatTime(1500 - gameState.timeRemaining)}
                                </div>
                                <button class="button" onclick="renderMission4Unlock()">‚û°Ô∏è Continuar</button>
                                <button class="button button-secondary" onclick="location.reload()">üè† Volver al Men√∫ Principal</button>
                            </div>
                        </div>
                    </div>
                `;
            } else {
                let errorExplanation = '';
                if (!conclusionCorrect && !killerCorrect) {
                    errorExplanation = `
                        <p style="margin-bottom: 15px;"><strong>Fallaste en ambas preguntas:</strong></p>
                        <div style="background: #f8d7da; padding: 15px; border-left: 4px solid #dc3545; border-radius: 5px; margin-bottom: 15px;">
                            <strong>Tu conclusi√≥n sobre lo que pas√≥:</strong> ${conclusion.text}<br><br>
                            <strong>Error:</strong> ${conclusion.explanation}
                        </div>
                        <div style="background: #f8d7da; padding: 15px; border-left: 4px solid #dc3545; border-radius: 5px; margin-bottom: 15px;">
                            <strong>Tu identificaci√≥n del responsable:</strong> ${killer.name}<br><br>
                            <strong>Error:</strong> ${killer.explanation}
                        </div>
                    `;
                } else if (!conclusionCorrect) {
                    errorExplanation = `
                        <p style="margin-bottom: 15px;"><strong>Identificaste correctamente al responsable, pero tu conclusi√≥n sobre lo que pas√≥ es incorrecta:</strong></p>
                        <div style="background: #f8d7da; padding: 15px; border-left: 4px solid #dc3545; border-radius: 5px; margin-bottom: 15px;">
                            <strong>Tu conclusi√≥n:</strong> ${conclusion.text}<br><br>
                            <strong>Error:</strong> ${conclusion.explanation}
                        </div>
                    `;
                } else {
                    errorExplanation = `
                        <p style="margin-bottom: 15px;"><strong>Tu conclusi√≥n sobre lo que pas√≥ es correcta, pero identificaste al responsable equivocado:</strong></p>
                        <div style="background: #f8d7da; padding: 15px; border-left: 4px solid #dc3545; border-radius: 5px; margin-bottom: 15px;">
                            <strong>Tu respuesta:</strong> ${killer.name}<br><br>
                            <strong>Error:</strong> ${killer.explanation}
                        </div>
                    `;
                }

                const correctConclusion = currentMissionData.conclusions.find(c => c.correct);
                const correctKiller = currentMissionData.killerOptions.find(k => k.correct);

                screen.innerHTML = `
                    <div class="end-screen">
                        <div class="result-box result-failure">
                            <h1 style="color: #dc3545; margin-bottom: 20px;">‚ùå HAS SIDO DESPEDIDO</h1>
                            <div style="font-size: 5em; margin: 20px 0;">üòû</div>
                            <h2 style="margin-bottom: 15px;">Fallaste, Hugo L.</h2>
                            <div class="story-text" style="text-align: left;">
                                ${errorExplanation}
                                <hr style="margin: 20px 0; border: none; border-top: 2px solid #e0e0e0;">
                                <h3 style="color: #e67e22; margin-bottom: 15px;">Las Respuestas Correctas:</h3>
                                <div style="background: #d4edda; padding: 15px; border-left: 4px solid #28a745; border-radius: 5px; margin-bottom: 15px;">
                                    <strong>¬øQu√© pas√≥?</strong><br>
                                    ${correctConclusion.text}<br><br>
                                    ${correctConclusion.explanation}
                                </div>
                                <div style="background: #d4edda; padding: 15px; border-left: 4px solid #28a745; border-radius: 5px; margin-bottom: 20px;">
                                    <strong>¬øQui√©n es el responsable?</strong><br>
                                    ${correctKiller.name}<br><br>
                                    ${correctKiller.explanation}
                                </div>
                                <hr style="margin: 20px 0; border: none; border-top: 2px solid #e0e0e0;">
                                <p style="font-style: italic; color: #555; margin-bottom: 15px;">
                                    El Capit√°n Rodr√≠guez te mira con tristeza. "Hugo, s√© lo que Miguel significaba para ti. 
                                    S√© que quer√≠as limpiar estas calles en su memoria. Pero este error... es demasiado grande."
                                </p>
                                <p style="font-style: italic; color: #555;">
                                    "Tu placa y tu arma. Lo siento, detective. Est√°s fuera del cuerpo."
                                </p>
                            </div>
                            <div style="margin-top: 25px;">
                                <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin-bottom: 15px;">
                                    <strong>Estad√≠sticas del Caso:</strong><br>
                                    üîç Pistas encontradas: ${gameState.cluesFound.length}/9<br>
                                    üë• Sospechosos interrogados: ${gameState.suspectsQuestioned.length}/2<br>
                                    ‚è±Ô∏è Tiempo usado: ${formatTime(1500 - gameState.timeRemaining)}
                                </div>
                                <button class="button" onclick="location.reload()">üîÑ Volver al Men√∫</button>
                            </div>
                        </div>
                    </div>
                `;
            }
        }

        function makeAccusation(suspectId) {
            stopTimer();
            const suspect = currentMissionData.suspects.find(s => s.id === suspectId);
            const correct = suspect.guilty;

            const screen = document.getElementById('game-screen');
            if (correct) {
                gameState.mission1Completed = true;
                saveProgress();
                screen.innerHTML = `
                    <div class="end-screen">
                        <div class="result-box result-success">
                            <h1 style="color: #28a745; margin-bottom: 20px;">üéâ ¬°CASO RESUELTO!</h1>
                            <div style="font-size: 5em; margin: 20px 0;">${suspect.avatar}</div>
                            <h2 style="margin-bottom: 15px;">${suspect.name}</h2>
                            <p style="font-size: 1.2em; margin-bottom: 20px;">
                                <strong>¬°Has identificado correctamente al asesino!</strong>
                            </p>
                            <div class="story-text" style="text-align: left;">
                                <h3 style="color: #e67e22; margin-bottom: 10px;">La Confesi√≥n:</h3>
                                <p style="margin-bottom: 15px;">
                                    "${suspect.name} confiesa entre l√°grimas: No quer√≠a matarlo... pero Los Verdes me obligaron. 
                                    Dijeron que el vagabundo hab√≠a visto algo que no deb√≠a, una operaci√≥n importante. 
                                    Me amenazaron: o lo eliminaba yo, o me eliminaban a m√≠ y a mi familia."
                                </p>
                                <p style="margin-bottom: 15px;">
                                    "Me dieron el tubo de metal, me dijeron d√≥nde encontrarlo y qu√© hacer. Lo hice parecer un robo 
                                    com√∫n... tom√© su cartera, desgarr√© su ropa. Pero el s√≠mbolo en la pared... esa fue su forma 
                                    de marcar territorio, de enviar un mensaje."
                                </p>
                                <p style="margin-bottom: 15px; padding: 15px; background: #fff3cd; border-left: 4px solid #ffc107; border-radius: 5px;">
                                    <strong>‚ö†Ô∏è NUEVA INFORMACI√ìN REVELADA:</strong><br><br>
                                    La investigaci√≥n revela que <strong>"Los Verdes"</strong> es una organizaci√≥n criminal sofisticada 
                                    que opera en las sombras. Su l√≠der permanece desconocido, usando intermediarios para mantener 
                                    su identidad en secreto. Marco era solo un pe√≥n m√°s en su red de operaciones.
                                </p>
                                <p style="margin-bottom: 15px;">
                                    <strong>Has resuelto el asesinato, pero la historia de Los Verdes apenas comienza...</strong>
                                </p>
                                <hr style="margin: 25px 0; border: none; border-top: 2px solid #e0e0e0;">
                                <p style="font-style: italic; color: #555;">
                                    Mientras completas el papeleo, tu tel√©fono suena. Es el jefe...
                                </p>
                            </div>
                            <div style="margin-top: 25px;">
                                <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin-bottom: 15px;">
                                    <strong>Estad√≠sticas del Caso:</strong><br>
                                    üîç Pistas encontradas: ${gameState.cluesFound.length}/9<br>
                                    üë• Sospechosos interrogados: ${gameState.suspectsQuestioned.length}/4<br>
                                    ‚è±Ô∏è Tiempo usado: ${formatTime(1500 - gameState.timeRemaining)}
                                </div>
                                <button class="button" onclick="renderBossDialogue()">üìû Contestar Llamada</button>
                            </div>
                        </div>
                    </div>
                `;
            } else {
                screen.innerHTML = `
                    <div class="end-screen">
                        <div class="result-box result-failure">
                            <h1 style="color: #dc3545; margin-bottom: 20px;">‚ùå ACUSACI√ìN INCORRECTA</h1>
                            <div style="font-size: 5em; margin: 20px 0;">${suspect.avatar}</div>
                            <h2 style="margin-bottom: 15px;">${suspect.name} es inocente</h2>
                            <div class="story-text" style="text-align: left;">
                                <p style="margin-bottom: 15px;">
                                    Has acusado a la persona equivocada. ${suspect.name} ten√≠a una coartada s√≥lida y no estaba 
                                    involucrado en el asesinato. Mientras tanto, el verdadero asesino ha logrado escapar.
                                </p>
                                <p style="margin-bottom: 15px;">
                                    <strong style="color: #e67e22;">El verdadero culpable era: Marco "El Flaco" Silva (Traficante)</strong>
                                </p>
                                <p>
                                    Las pistas clave eran: el arma homicida con huellas dactilares, el s√≠mbolo verde de Los Verdes 
                                    (la banda que le orden√≥ el asesinato), y el testimonio del testigo que lo vio huyendo con sudadera verde.
                                </p>
                            </div>
                            <div style="margin-top: 25px;">
                                <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin-bottom: 15px;">
                                    <strong>Estad√≠sticas del Caso:</strong><br>
                                    üîç Pistas encontradas: ${gameState.cluesFound.length}/9<br>
                                    üë• Sospechosos interrogados: ${gameState.suspectsQuestioned.length}/4
                                </div>
                                <button class="button" onclick="location.reload()">üîÑ Intentar de Nuevo</button>
                            </div>
                        </div>
                    </div>
                `;
            }
        }

        function renderNotebook() {
            if (gameState.cluesFound.length === 0) return '';

            const cluesHTML = gameState.cluesFound.map(clueId => {
                const clue = currentMissionData.clues[clueId];
                return `<div class="notebook-item">üìå ${clue.name}: ${clue.description}</div>`;
            }).join('');

            return `
                <div class="notebook">
                    <h3>üìì Notas del Detective</h3>
                    ${cluesHTML}
                </div>
            `;
        }

        function renderBossDialogue() {
            const screen = document.getElementById('game-screen');
            const nextMission = gameState.currentMission === 1 ? 2 : 3;
            
            if (nextMission === 2) {
                screen.innerHTML = `
                    <div class="end-screen">
                        <div class="story-text" style="max-width: 700px; margin: 0 auto;">
                            <h2 style="color: #e67e22; margin-bottom: 20px; text-align: center;">üìû Llamada del Jefe</h2>
                            
                            <div style="background: white; padding: 25px; border-radius: 10px; margin-bottom: 20px; box-shadow: 0 4px 15px rgba(0,0,0,0.1);">
                                <div style="display: flex; align-items: center; margin-bottom: 20px;">
                                    <div style="font-size: 4em; margin-right: 20px;">üëî</div>
                                    <div>
                                        <strong style="font-size: 1.2em;">Capit√°n Rodr√≠guez</strong>
                                        <p style="color: #7f8c8d; font-size: 0.9em; margin-top: 5px;">Jefe de Homicidios</p>
                                    </div>
                                </div>
                                
                                <div style="background: #f8f9fa; padding: 20px; border-radius: 8px; border-left: 4px solid #3498db; margin-bottom: 15px;">
                                    <p style="margin-bottom: 15px; font-style: italic;">
                                        "Hugo, excelente trabajo con el caso del callej√≥n. Marco Silva est√° cantando como un canario. 
                                        Aunque... esto de Los Verdes me preocupa. Es m√°s grande de lo que pens√°bamos."
                                    </p>
                                    <p style="margin-bottom: 15px; font-style: italic;">
                                        "S√© que esto es personal para ti. Miguel... tu hijo... s√© que perdiste mucho por culpa de 
                                        estas pandillas. Pero necesito que mantengas la cabeza fr√≠a."
                                    </p>
                                    <p style="margin-bottom: 15px; font-style: italic;">
                                        "Tenemos otro caso y no hay tiempo que perder."
                                    </p>
                                </div>
                                
                                <div style="background: #fff3cd; padding: 20px; border-radius: 8px; border-left: 4px solid #ffc107; margin-bottom: 15px;">
                                    <h3 style="color: #e67e22; margin-bottom: 15px;">üìã Nueva Misi√≥n Asignada</h3>
                                    <p style="margin-bottom: 15px; font-style: italic;">
                                        "La familia Ram√≠rez. Cuatro personas. Desaparecieron sin dejar rastro hace 24 horas. 
                                        Entramos a la casa y... nada. No hay violencia, no hay robo. Simplemente se esfumaron."
                                    </p>
                                    <p style="margin-bottom: 15px; font-style: italic;">
                                        "La casa est√° intacta. La cena todav√≠a estaba en la mesa. El televisor encendido. 
                                        Es como si hubieran salido a comprar leche y nunca regresaron."
                                    </p>
                                    <p style="font-style: italic; color: #dc3545; font-weight: bold;">
                                        "Hugo, este caso es delicado. No hay sospechosos, solo evidencia. Necesito que llegues 
                                        a la conclusi√≥n correcta. El alcalde est√° presionando y... bueno, ya sabes c√≥mo es esto. 
                                        Si te equivocas en este, no podr√© protegerte. Es tu placa la que est√° en juego."
                                    </p>
                                </div>
                                
                                <div style="text-align: center; padding: 15px; background: #ecf0f1; border-radius: 8px;">
                                    <p style="font-style: italic; margin-bottom: 0;">
                                        "Conf√≠o en ti, detective. Ve a la escena del crimen y averigua qu√© demonios pas√≥ con los Ram√≠rez."
                                    </p>
                                </div>
                            </div>
                            
                            <div style="text-align: center;">
                                <button class="button" onclick="startMission2()">üöî Ir a la Escena del Crimen</button>
                                <button class="button button-secondary" onclick="location.reload()">üè† Volver al Men√∫ Principal</button>
                            </div>
                        </div>
                    </div>
                `;
            } else {
                // Di√°logo para transici√≥n a misi√≥n 3
                screen.innerHTML = `
                    <div class="end-screen">
                        <div class="story-text" style="max-width: 700px; margin: 0 auto;">
                            <h2 style="color: #e67e22; margin-bottom: 20px; text-align: center;">üìû Llamada Urgente - 3:30 AM</h2>
                            
                            <div style="background: white; padding: 25px; border-radius: 10px; margin-bottom: 20px; box-shadow: 0 4px 15px rgba(0,0,0,0.1);">
                                <div style="display: flex; align-items: center; margin-bottom: 20px;">
                                    <div style="font-size: 4em; margin-right: 20px;">üëî</div>
                                    <div>
                                        <strong style="font-size: 1.2em;">Capit√°n Rodr√≠guez</strong>
                                        <p style="color: #7f8c8d; font-size: 0.9em; margin-top: 5px;">Jefe de Homicidios</p>
                                    </div>
                                </div>
                                
                                <div style="background: #f8d7da; padding: 20px; border-radius: 8px; border-left: 4px solid #dc3545; margin-bottom: 15px;">
                                    <p style="margin-bottom: 15px; font-style: italic; font-weight: bold;">
                                        "Hugo, despierta. Tenemos un problema SERIO. El informante... est√° muerto."
                                    </p>
                                    <p style="margin-bottom: 15px; font-style: italic;">
                                        "Carlos Vega. Iba a testificar ma√±ana contra Los Verdes. Lo ten√≠amos en una casa de seguridad. 
                                        Ubicaci√≥n clasificada. Solo lo sab√≠amos cinco personas de m√°xima confianza."
                                    </p>
                                    <p style="margin-bottom: 15px; font-style: italic;">
                                        "Y ahora est√° muerto. Un disparo profesional. Las c√°maras 'fallaron'. Sin testigos. 
                                        Hugo... alguien filtr√≥ la informaci√≥n."
                                    </p>
                                </div>
                                
                                <div style="background: #d4edda; padding: 20px; border-radius: 8px; border-left: 4px solid #28a745; margin-bottom: 15px;">
                                    <p style="margin-bottom: 15px; font-style: italic;">
                                        "S√© que perdiste a Miguel por estas pandillas. S√© lo que Los Verdes le han quitado a esta ciudad. 
                                        Por eso conf√≠o en ti para este caso. Pero Hugo..."
                                    </p>
                                    <p style="margin-bottom: 15px; font-style: italic; font-weight: bold; color: #dc3545;">
                                        "Ten mucho cuidado. Si alguien vendi√≥ al informante desde dentro... no sabemos qui√©n m√°s 
                                        est√° comprometido. Conf√≠a en las pistas, no en las personas. Ni siquiera en m√≠."
                                    </p>
                                </div>
                                
                                <div style="background: #fff3cd; padding: 20px; border-radius: 8px; border-left: 4px solid #ffc107; margin-bottom: 15px;">
                                    <p style="margin-bottom: 15px; font-style: italic;">
                                        "Solo tengo dos sospechosos disponibles para que interrogues. Las pistas en la escena son 
                                        escasas. Necesito que descubras QU√â pas√≥ exactamente y QUI√âN es el responsable."
                                    </p>
                                    <p style="font-style: italic; color: #dc3545; font-weight: bold;">
                                        "Si fallas en esto, Hugo... no solo perder√°s tu placa. Los Verdes ganar√°n. Y todo por lo 
                                        que has luchado desde que perdiste a Miguel habr√° sido en vano."
                                    </p>
                                </div>
                                
                                <div style="text-align: center; padding: 15px; background: #ecf0f1; border-radius: 8px;">
                                    <p style="font-style: italic; margin-bottom: 0;">
                                        "Encuentra la verdad, detective. Antes de que sea demasiado tarde."
                                    </p>
                                </div>
                            </div>
                            
                            <div style="text-align: center;">
                                <button class="button" onclick="startMission3()">üöî Ir a la Casa de Seguridad</button>
                                <button class="button button-secondary" onclick="location.reload()">üè† Volver al Men√∫ Principal</button>
                            </div>
                        </div>
                    </div>
                `;
            }
        }

        function startMission1() {
            gameState.currentMission = 1;
            gameState.cluesFound = [];
            gameState.suspectsQuestioned = [];
            gameState.timeRemaining = 1500;
            currentMissionData = gameData.mission1;
            renderIntro();
        }

        function startMission2() {
            gameState.currentMission = 2;
            gameState.cluesFound = [];
            gameState.suspectsQuestioned = [];
            gameState.timeRemaining = 1500;
            currentMissionData = gameData.mission2;
            renderIntroMission2();
        }

        function startMission3() {
            gameState.currentMission = 3;
            gameState.cluesFound = [];
            gameState.suspectsQuestioned = [];
            gameState.timeRemaining = 1500;
            currentMissionData = gameData.mission3;
            renderIntroMission3();
        }

        function startMission4() {
            gameState.currentMission = 4;
            gameState.filesReviewed = [];
            gameState.suspicionLevel = 0;
            gameState.timeRemaining = 900; // 15 minutos para esta misi√≥n
            currentMissionData = gameData.mission4;
            renderIntroMission4();
        }

        function startMission5() {
            gameState.currentMission = 5;
            gameState.cluesFound = [];
            gameState.suspectsQuestioned = [];
            gameState.timeRemaining = 1500;
            currentMissionData = gameData.mission5;
            renderIntroMission5();
        }

        function startGame() {
            gameState.timerInterval = setInterval(updateTimer, 1000);
            renderLocationSelect();
        }

        function startGameMission2() {
            gameState.timerInterval = setInterval(updateTimer, 1000);
            renderLocationSelect();
        }

        function startGameMission3() {
            gameState.timerInterval = setInterval(updateTimer, 1000);
            renderLocationSelect();
        }

        function startGameMission4() {
            gameState.timerInterval = setInterval(updateTimer, 1000);
            renderArchiveRoom();
        }

        function startGameMission5() {
            gameState.timerInterval = setInterval(updateTimer, 1000);
            renderLocationSelect();
        }

        function renderMission5Conclusions() {
            const screen = document.getElementById('game-screen');
            const conclusionsHTML = currentMissionData.conclusions.map(conclusion => {
                return `
                    <button class="question-btn" onclick="saveMission5WhatHappened('${conclusion.id}')" style="text-align: center; padding: 20px;">
                        ${conclusion.text}
                    </button>
                `;
            }).join('');

            screen.innerHTML = `
                <div class="end-screen">
                    <div class="accusation-panel">
                        <h2 style="color: #c0392b; margin-bottom: 15px;">üéØ Parte 1: ¬øQu√© pas√≥ realmente con Garc√≠a?</h2>
                        <p style="margin-bottom: 15px;">
                            Has investigado la escena del crimen. Has revisado las pistas. Has interrogado a los sospechosos.
                        </p>
                        <p style="margin-bottom: 20px; color: #dc3545; font-weight: bold;">
                            ‚ö†Ô∏è ADVERTENCIA: Debes acertar AMBAS preguntas. Si fallas cualquiera, ser√°s despedido.
                        </p>
                        <h3 style="margin-bottom: 15px;">Primera Pregunta: ¬øQu√© pas√≥ realmente con Eduardo Garc√≠a?</h3>
                        ${conclusionsHTML}
                    </div>
                    <div style="text-align: center; margin-top: 20px;">
                        <button class="button button-secondary" onclick="renderLocationSelect()">‚¨ÖÔ∏è Seguir Investigando</button>
                    </div>
                    ${renderNotebook()}
                </div>
            `;
        }

        let mission5WhatHappened = null;

        function saveMission5WhatHappened(conclusionId) {
            mission5WhatHappened = conclusionId;
            renderMission5TargetSelect();
        }

        function renderMission5TargetSelect() {
            const screen = document.getElementById('game-screen');
            const targetsHTML = currentMissionData.targetQuestion.map(target => {
                return `
                    <button class="question-btn" onclick="makeMission5FinalAnswer('${target.id}')" style="text-align: center; padding: 20px;">
                        ${target.text}
                    </button>
                `;
            }).join('');

            screen.innerHTML = `
                <div class="end-screen">
                    <div class="accusation-panel" style="background: #fff3cd;">
                        <h2 style="color: #c0392b; margin-bottom: 15px;">üéØ Parte 2: ¬øA qui√©n iba a denunciar Garc√≠a?</h2>
                        <p style="margin-bottom: 15px;">
                            Has determinado lo que pas√≥. Ahora la pregunta m√°s importante:
                        </p>
                        <p style="margin-bottom: 20px; color: #dc3545; font-weight: bold;">
                            ‚ö†Ô∏è Esta decisi√≥n cambiar√° todo. Piensa cuidadosamente.
                        </p>
                        <h3 style="margin-bottom: 15px;">Segunda Pregunta: ¬øQui√©n era el objetivo de la denuncia de Garc√≠a?</h3>
                        ${targetsHTML}
                    </div>
                    <div style="text-align: center; margin-top: 20px;">
                        <button class="button button-secondary" onclick="renderMission5Conclusions()">‚¨ÖÔ∏è Cambiar Primera Respuesta</button>
                    </div>
                    ${renderNotebook()}
                </div>
            `;
        }

        function makeMission5FinalAnswer(targetId) {
            stopTimer();
            const whatHappened = currentMissionData.conclusions.find(c => c.id === mission5WhatHappened);
            const whoTarget = currentMissionData.targetQuestion.find(t => t.id === targetId);
            
            const whatCorrect = whatHappened.correct;
            const whoCorrect = whoTarget.correct;
            const bothCorrect = whatCorrect && whoCorrect;

            const screen = document.getElementById('game-screen');
            
            if (bothCorrect) {
                screen.innerHTML = `
                    <div class="end-screen">
                        <div class="result-box result-success">
                            <h1 style="color: #28a745; margin-bottom: 20px;">‚úÖ ¬°HAS DESCUBIERTO LA VERDAD!</h1>
                            <div style="font-size: 5em; margin: 20px 0;">üéØ</div>
                            <h2 style="margin-bottom: 15px;">La Corrupci√≥n Revelada</h2>
                            
                            <div class="story-text" style="text-align: left;">
                                <h3 style="color: #c0392b; margin-bottom: 15px;">Tus Conclusiones:</h3>
                                <div style="background: #d4edda; padding: 20px; border-left: 4px solid #28a745; border-radius: 5px; margin-bottom: 15px;">
                                    <strong>¬øQu√© pas√≥?</strong><br>
                                    ${whatHappened.text}<br><br>
                                    ${whatHappened.explanation}
                                </div>
                                <div style="background: #d4edda; padding: 20px; border-left: 4px solid #28a745; border-radius: 5px; margin-bottom: 20px;">
                                    <strong>¬øA qui√©n iba a denunciar?</strong><br>
                                    ${whoTarget.text}<br><br>
                                    ${whoTarget.explanation}
                                </div>
                                
                                <hr style="margin: 25px 0; border: none; border-top: 2px solid #e0e0e0;">
                                
                                <div style="background: #2c3e50; color: white; padding: 25px; border-radius: 10px; margin-bottom: 20px;">
                                    <h3 style="color: #e74c3c; margin-bottom: 15px; text-align: center;">üíÄ EL MOMENTO DE LA VERDAD</h3>
                                    <p style="margin-bottom: 15px;">
                                        Lo sabes. Tienes todas las pruebas. El Capit√°n Rodr√≠guez no solo protege a Los Verdes... 
                                        √©l mismo es parte de la corrupci√≥n. Casos archivados. Evidencias perdidas. Testigos muertos.
                                    </p>
                                    <p style="margin-bottom: 15px; font-style: italic;">
                                        Eduardo Garc√≠a iba a exponerlo. Por eso fue asesinado. Por eso el caso se cerr√≥ en 24 horas. 
                                        El asesino... fue ordenado por el mismo hombre que deb√≠a proteger a la ciudad.
                                    </p>
                                    <p style="margin-bottom: 15px; color: #e74c3c; font-weight: bold;">
                                        Preparas tu informe. Compilas toda la evidencia. Los archivos de la Misi√≥n 4. El caso de Garc√≠a. 
                                        El informante muerto. Todo conecta. Todo apunta al Capit√°n Rodr√≠guez.
                                    </p>
                                    <p style="font-style: italic;">
                                        Pero cuando llega el momento de presentarlo... dudas. Si lo acusas y no tienes suficiente, 
                                        ser√°s t√∫ el siguiente. Si esperas... m√°s gente morir√°.
                                    </p>
                                </div>

                                <div style="background: #fff3cd; padding: 25px; border-left: 4px solid #ffc107; border-radius: 5px; margin-bottom: 20px;">
                                    <h3 style="color: #e67e22; margin-bottom: 10px;">El Peso de la Decisi√≥n</h3>
                                    <p style="margin-bottom: 15px;">
                                        Has llegado m√°s lejos que nadie. Has descubierto la verdad que otros murieron intentando revelar. 
                                        Miguel. Javier. Garc√≠a. El informante. Todos v√≠ctimas del mismo sistema corrupto.
                                    </p>
                                    <p style="margin-bottom: 15px; font-style: italic; color: #555;">
                                        Miras la foto de Miguel en tu escritorio. Su sonrisa. Su futuro robado por las pandillas que 
                                        tu propio jefe protege. Las l√°grimas caen mientras escribes el √∫ltimo p√°rrafo de tu informe.
                                    </p>
                                    <p style="font-weight: bold; color: #dc3545;">
                                        "Por ti, hijo. Por todos. Esto termina ahora."
                                    </p>
                                </div>

                                <p style="text-align: center; font-size: 1.3em; font-style: italic; color: #2c3e50; margin: 30px 0;">
                                    <strong>CONTINUAR√Å...</strong>
                                </p>

                                <p style="text-align: center; font-style: italic; color: #555;">
                                    Has completado todas las misiones actuales de "La Sombra de Jalejos".<br>
                                    La historia de Hugo L. y su lucha contra la corrupci√≥n continuar√°...
                                </p>
                            </div>

                            <div style="margin-top: 25px;">
                                <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin-bottom: 15px;">
                                    <strong>Estad√≠sticas del Caso:</strong><br>
                                    üîç Pistas encontradas: ${gameState.cluesFound.length}/12<br>
                                    üë• Sospechosos interrogados: ${gameState.suspectsQuestioned.length}/3<br>
                                    ‚è±Ô∏è Tiempo usado: ${formatTime(1500 - gameState.timeRemaining)}
                                </div>
                                <button class="button" onclick="location.reload()">üè† Volver al Men√∫ Principal</button>
                            </div>
                        </div>
                    </div>
                `;
            } else {
                // Failed - similar to mission 3 failure screen
                let errorExplanation = '';
                if (!whatCorrect && !whoCorrect) {
                    errorExplanation = `
                        <p style="margin-bottom: 15px;"><strong>Fallaste en ambas preguntas:</strong></p>
                        <div style="background: #f8d7da; padding: 15px; border-left: 4px solid #dc3545; border-radius: 5px; margin-bottom: 15px;">
                            <strong>Tu conclusi√≥n sobre lo que pas√≥:</strong> ${whatHappened.text}<br><br>
                            <strong>Error:</strong> ${whatHappened.explanation}
                        </div>
                        <div style="background: #f8d7da; padding: 15px; border-left: 4px solid #dc3545; border-radius: 5px; margin-bottom: 15px;">
                            <strong>Tu identificaci√≥n del objetivo:</strong> ${whoTarget.text}<br><br>
                            <strong>Error:</strong> ${whoTarget.explanation}
                        </div>
                    `;
                } else if (!whatCorrect) {
                    errorExplanation = `
                        <p style="margin-bottom: 15px;"><strong>Identificaste correctamente el objetivo, pero tu conclusi√≥n sobre lo que pas√≥ es incorrecta:</strong></p>
                        <div style="background: #f8d7da; padding: 15px; border-left: 4px solid #dc3545; border-radius: 5px; margin-bottom: 15px;">
                            <strong>Tu conclusi√≥n:</strong> ${whatHappened.text}<br><br>
                            <strong>Error:</strong> ${whatHappened.explanation}
                        </div>
                    `;
                } else {
                    errorExplanation = `
                        <p style="margin-bottom: 15px;"><strong>Tu conclusi√≥n sobre lo que pas√≥ es correcta, pero identificaste al objetivo equivocado:</strong></p>
                        <div style="background: #f8d7da; padding: 15px; border-left: 4px solid #dc3545; border-radius: 5px; margin-bottom: 15px;">
                            <strong>Tu respuesta:</strong> ${whoTarget.text}<br><br>
                            <strong>Error:</strong> ${whoTarget.explanation}
                        </div>
                    `;
                }

                const correctWhat = currentMissionData.conclusions.find(c => c.correct);
                const correctWho = currentMissionData.targetQuestion.find(t => t.correct);

                screen.innerHTML = `
                    <div class="end-screen">
                        <div class="result-box result-failure">
                            <h1 style="color: #dc3545; margin-bottom: 20px;">‚ùå HAS SIDO DESPEDIDO</h1>
                            <div style="font-size: 5em; margin: 20px 0;">üòû</div>
                            <h2 style="margin-bottom: 15px;">Fallaste, Hugo L.</h2>
                            
                            <div class="story-text" style="text-align: left;">
                                ${errorExplanation}
                                
                                <hr style="margin: 20px 0; border: none; border-top: 2px solid #e0e0e0;">
                                
                                <h3 style="color: #e67e22; margin-bottom: 15px;">Las Respuestas Correctas:</h3>
                                <div style="background: #d4edda; padding: 15px; border-left: 4px solid #28a745; border-radius: 5px; margin-bottom: 15px;">
                                    <strong>¬øQu√© pas√≥?</strong><br>
                                    ${correctWhat.text}<br><br>
                                    ${correctWhat.explanation}
                                </div>
                                <div style="background: #d4edda; padding: 15px; border-left: 4px solid #28a745; border-radius: 5px; margin-bottom: 20px;">
                                    <strong>¬øA qui√©n iba a denunciar?</strong><br>
                                    ${correctWho.text}<br><br>
                                    ${correctWho.explanation}
                                </div>
                                
                                <hr style="margin: 20px 0; border: none; border-top: 2px solid #e0e0e0;">
                                
                                <p style="font-style: italic; color: #555; margin-bottom: 15px;">
                                    El Capit√°n Rodr√≠guez revisa tu informe con expresi√≥n decepcionada.
                                </p>
                                <p style="font-style: italic; color: #555;">
                                    "Hugo... este error es imperdonable. Tu placa. Tu arma. Est√°s fuera del cuerpo."
                                </p>
                                <p style="font-style: italic; color: #dc3545; font-weight: bold; margin-top: 15px;">
                                    La corrupci√≥n contin√∫a. Los Verdes siguen operando. Miguel nunca ser√° vengado.
                                </p>
                            </div>

                            <div style="margin-top: 25px;">
                                <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin-bottom: 15px;">
                                    <strong>Estad√≠sticas del Caso:</strong><br>
                                    üîç Pistas encontradas: ${gameState.cluesFound.length}/12<br>
                                    üë• Sospechosos interrogados: ${gameState.suspectsQuestioned.length}/3<br>
                                    ‚è±Ô∏è Tiempo usado: ${formatTime(1500 - gameState.timeRemaining)}
                                </div>
                                <button class="button" onclick="location.reload()">üîÑ Volver al Men√∫</button>
                            </div>
                        </div>
                    </div>
                `;
            }
        }

        function renderArchiveRoom() {
            const screen = document.getElementById('game-screen');
            const suspicionColor = gameState.suspicionLevel < 5 ? '#28a745' : (gameState.suspicionLevel < 8 ? '#ffc107' : '#dc3545');
            
            const archivesHTML = currentMissionData.archives.map(archive => {
                const reviewed = gameState.filesReviewed.includes(archive.id);
                const riskColor = archive.suspicionRisk === 1 ? '#28a745' : (archive.suspicionRisk === 2 ? '#ffc107' : '#dc3545');
                
                return `
                    <div class="suspect-card ${reviewed ? 'questioned' : ''}" onclick="${!reviewed && gameState.suspicionLevel < 10 ? `reviewArchive('${archive.id}')` : ''}" 
                         style="${reviewed ? 'opacity: 0.7;' : ''} ${gameState.suspicionLevel >= 10 ? 'cursor: not-allowed; opacity: 0.5;' : ''}">
                        <div style="font-size: 2em; margin-bottom: 10px;">üìÅ</div>
                        <div class="suspect-name" style="font-size: 1em;">${archive.name}</div>
                        <div style="margin-top: 10px;">
                            <span style="background: ${riskColor}; color: white; padding: 5px 10px; border-radius: 15px; font-size: 0.8em;">
                                ${archive.suspicionRisk === 1 ? 'Riesgo Bajo' : (archive.suspicionRisk === 2 ? 'Riesgo Medio' : 'Riesgo Alto')}
                            </span>
                        </div>
                        ${reviewed ? '<div class="badge" style="margin-top: 10px;">Revisado</div>' : ''}
                    </div>
                `;
            }).join('');

            const importantFilesReviewed = gameState.filesReviewed.filter(id => {
                const file = currentMissionData.archives.find(a => a.id === id);
                return file && file.important;
            }).length;

            screen.innerHTML = `
                <div class="interrogation-screen">
                    <div class="story-text">
                        <h2 style="color: #8e44ad; margin-bottom: 10px;">üî¶ Sala de Archivos - Revisi√≥n Nocturna</h2>
                        <p>Selecciona los archivos a revisar. Ten cuidado: algunos levantar√°n m√°s sospecha que otros.</p>
                    </div>

                    <div style="background: #2c3e50; color: white; padding: 20px; border-radius: 10px; margin: 20px 0;">
                        <div style="display: flex; justify-content: space-around; text-align: center;">
                            <div>
                                <div style="font-size: 0.9em; opacity: 0.8;">Nivel de Sospecha</div>
                                <div style="font-size: 2em; font-weight: bold; color: ${suspicionColor};">${gameState.suspicionLevel}/10</div>
                            </div>
                            <div>
                                <div style="font-size: 0.9em; opacity: 0.8;">Archivos Revisados</div>
                                <div style="font-size: 2em; font-weight: bold;">${gameState.filesReviewed.length}/8</div>
                            </div>
                            <div>
                                <div style="font-size: 0.9em; opacity: 0.8;">Casos Importantes</div>
                                <div style="font-size: 2em; font-weight: bold; color: #e67e22;">${importantFilesReviewed}/4</div>
                            </div>
                        </div>
                        ${gameState.suspicionLevel >= 10 ? '<div style="margin-top: 15px; text-align: center; color: #e74c3c; font-weight: bold;">‚ö†Ô∏è NIVEL DE SOSPECHA CR√çTICO - NO PUEDES REVISAR M√ÅS ARCHIVOS</div>' : ''}
                    </div>

                    <div class="suspect-grid">
                        ${archivesHTML}
                    </div>

                    <div style="text-align: center; margin-top: 20px;">
                        ${importantFilesReviewed >= 3 ? '<button class="button" onclick="renderMission4Conclusions()">üéØ Analizar Patrones y Concluir</button>' : 
                          '<p style="color: #7f8c8d; font-style: italic;">Necesitas revisar al menos 3 casos importantes para sacar conclusiones</p>'}
                    </div>

                    ${renderMission4Notes()}
                </div>
            `;
        }

        function reviewArchive(archiveId) {
            const archive = currentMissionData.archives.find(a => a.id === archiveId);
            if (!archive || gameState.filesReviewed.includes(archiveId)) return;

            gameState.filesReviewed.push(archiveId);
            gameState.suspicionLevel += archive.suspicionRisk;

            const screen = document.getElementById('game-screen');
            screen.innerHTML = `
                <div class="interrogation-screen">
                    <div class="story-text">
                        <h2 style="color: #8e44ad;">üìÑ ${archive.name}</h2>
                        <p style="font-size: 0.9em; color: #7f8c8d;">Firmado por: ${archive.signedBy}</p>
                    </div>

                    <div class="question-box">
                        <div style="background: #ecf0f1; padding: 20px; border-radius: 8px; margin: 20px 0;">
                            <h3 style="margin-bottom: 15px;">Contenido del Expediente:</h3>
                            <p style="line-height: 1.8;">${archive.content}</p>
                            ${archive.inconsistency ? `
                                <div style="margin-top: 20px; padding: 15px; background: #fff3cd; border-left: 4px solid #ffc107; border-radius: 5px;">
                                    <strong>‚ö†Ô∏è Inconsistencia Detectada:</strong><br>
                                    ${archive.inconsistency}
                                </div>
                            ` : ''}
                        </div>

                        <div style="background: ${archive.suspicionRisk === 3 ? '#f8d7da' : '#d4edda'}; padding: 15px; border-radius: 8px; text-align: center;">
                            <strong>Sospecha generada: +${archive.suspicionRisk}</strong>
                            <p style="margin-top: 10px; font-size: 0.9em;">
                                ${archive.suspicionRisk === 1 ? 'Este archivo no llamar√° mucho la atenci√≥n.' : 
                                  archive.suspicionRisk === 2 ? 'Este archivo podr√≠a levantar alguna sospecha.' : 
                                  '¬°Este archivo es altamente sensible! Has aumentado mucho el riesgo.'}
                            </p>
                        </div>
                    </div>

                    <div style="text-align: center; margin-top: 20px;">
                        <button class="button button-secondary" onclick="renderArchiveRoom()">‚¨ÖÔ∏è Volver a los Archivos</button>
                    </div>
                </div>
            `;
        }

        function renderMission4Notes() {
            const importantFiles = gameState.filesReviewed.filter(id => {
                const file = currentMissionData.archives.find(a => a.id === id);
                return file && file.important;
            });

            if (importantFiles.length === 0) return '';

            const notesHTML = importantFiles.map(fileId => {
                const file = currentMissionData.archives.find(a => a.id === fileId);
                return `
                    <div class="notebook-item">
                        üìå <strong>${file.name}</strong><br>
                        Firmado por: ${file.signedBy}<br>
                        ${file.inconsistency ? `<em style="color: #e67e22;">Inconsistencia: ${file.inconsistency}</em>` : ''}
                    </div>
                `;
            }).join('');

            return `
                <div class="notebook">
                    <h3>üìì Notas de Hugo - Casos Sospechosos</h3>
                    ${notesHTML}
                </div>
            `;
        }

        function updateTimer() {
            gameState.timeRemaining--;
            const timeDisplay = document.getElementById('time-remaining');
            if (timeDisplay) {
                timeDisplay.textContent = formatTime(gameState.timeRemaining);
                if (gameState.timeRemaining <= 60) {
                    timeDisplay.style.color = '#dc3545';
                }
            }

            if (gameState.timeRemaining <= 0) {
                stopTimer();
                gameOver();
            }
        }

        function stopTimer() {
            if (gameState.timerInterval) {
                clearInterval(gameState.timerInterval);
            }
        }

        function formatTime(seconds) {
            const mins = Math.floor(seconds / 60);
            const secs = seconds % 60;
            return `${mins}:${secs.toString().padStart(2, '0')}`;
        }

        function updateStats() {
            const totalClues = gameState.currentMission === 1 ? 9 : (gameState.currentMission === 2 ? 12 : 9);
            const totalSuspects = gameState.currentMission === 1 ? 4 : (gameState.currentMission === 2 ? 0 : 2);
            
            if (gameState.currentMission === 4) {
                // Mission 4 doesn't use standard stats
                return;
            }
            
            document.getElementById('clues-count').textContent = `${gameState.cluesFound.length}/${totalClues}`;
            if (totalSuspects > 0) {
                document.getElementById('suspects-count').textContent = `${gameState.suspectsQuestioned.length}/${totalSuspects}`;
            } else {
                document.getElementById('suspects-count').textContent = 'N/A';
            }
        }

        function renderMission4Conclusions() {
            const screen = document.getElementById('game-screen');
            const conclusionsHTML = currentMissionData.conclusions.map(conclusion => {
                return `
                    <button class="question-btn" onclick="saveMission4Conclusion('${conclusion.id}')" style="text-align: center; padding: 20px;">
                        ${conclusion.text}
                    </button>
                `;
            }).join('');

            screen.innerHTML = `
                <div class="end-screen">
                    <div class="accusation-panel">
                        <h2 style="color: #8e44ad; margin-bottom: 15px;">üîç An√°lisis de Patrones</h2>
                        <p style="margin-bottom: 15px;">
                            Has revisado los archivos. Has visto las inconsistencias. Ahora debes llegar a una conclusi√≥n.
                        </p>
                        <p style="margin-bottom: 20px; color: #555; font-style: italic;">
                            Recuerda: todos los casos importantes archivados relacionados con Los Verdes fueron firmados por la misma persona...
                        </p>
                        <h3 style="margin-bottom: 15px;">¬øCu√°l es tu conclusi√≥n sobre las inconsistencias?</h3>
                        ${conclusionsHTML}
                    </div>
                    <div style="text-align: center; margin-top: 20px;">
                        <button class="button button-secondary" onclick="renderArchiveRoom()">‚¨ÖÔ∏è Revisar M√°s Archivos</button>
                    </div>
                    ${renderMission4Notes()}
                </div>
            `;
        }

        let mission4SelectedConclusion = null;

        function saveMission4Conclusion(conclusionId) {
            mission4SelectedConclusion = conclusionId;
            renderMission4Discovery();
        }

        function renderMission4Discovery() {
            const screen = document.getElementById('game-screen');
            screen.innerHTML = `
                <div class="end-screen">
                    <div class="story-text" style="max-width: 700px; margin: 0 auto;">
                        <h2 style="color: #dc3545; margin-bottom: 20px; text-align: center;">‚ö†Ô∏è ¬°DESCUBIERTO!</h2>
                        
                        <div style="background: #2c3e50; color: white; padding: 25px; border-radius: 10px; margin-bottom: 20px;">
                            <p style="margin-bottom: 15px; font-style: italic;">
                                Mientras guardas el √∫ltimo archivo, escuchas pasos r√°pidos. Un guardia de seguridad entra abruptamente:
                            </p>
                            <p style="margin-bottom: 15px; font-style: italic; color: #e74c3c; font-weight: bold;">
                                "¬°Oye! ¬øQu√© haces aqu√≠ a estas horas? Esta √°rea est√° restringida por la noche."
                            </p>
                            <p style="margin-bottom: 15px; font-style: italic;">
                                Logras salir r√°pidamente, pero al d√≠a siguiente...
                            </p>
                        </div>

                        <div style="background: white; padding: 25px; border-radius: 10px; margin-bottom: 20px; box-shadow: 0 4px 15px rgba(0,0,0,0.1);">
                            <div style="display: flex; align-items: center; margin-bottom: 20px;">
                                <div style="font-size: 4em; margin-right: 20px;">üëî</div>
                                <div>
                                    <strong style="font-size: 1.2em;">Capit√°n Rodr√≠guez</strong>
                                    <p style="color: #7f8c8d; font-size: 0.9em; margin-top: 5px;">Oficina - 8:00 AM</p>
                                </div>
                            </div>
                            
                            <div style="background: #f8d7da; padding: 20px; border-radius: 8px; border-left: 4px solid #dc3545; margin-bottom: 15px;">
                                <p style="margin-bottom: 15px; font-style: italic;">
                                    "Hugo, tenemos un problema. Alguien estuvo revisando archivos clasificados anoche en la sala del s√≥tano. 
                                    El sistema de seguridad registr√≥ actividad no autorizada."
                                </p>
                                <p style="margin-bottom: 15px; font-style: italic;">
                                    "Los guardias vieron a alguien, pero no pudieron identificarlo claramente. Sin embargo... 
                                    solo dos personas ten√≠an acceso a esa √°rea anoche: t√∫ y el Detective Javier Mart√≠nez."
                                </p>
                                <p style="font-style: italic; font-weight: bold; color: #dc3545;">
                                    "Necesito saber qui√©n fue, Hugo. Esto es muy serio. Violaci√≥n de protocolos. Acceso no autorizado. 
                                    Quien haya sido esto... podr√≠a enfrentar suspensi√≥n o peor."
                                </p>
                            </div>

                            <div style="text-align: center; padding: 15px; background: #fff3cd; border-radius: 8px;">
                                <p style="margin-bottom: 0; font-weight: bold;">
                                    El Capit√°n te mira fijamente, esperando tu respuesta...
                                </p>
                            </div>
                        </div>

                        <div style="background: #f8f9fa; padding: 20px; border-radius: 8px; margin-bottom: 20px;">
                            <h3 style="color: #e67e22; margin-bottom: 15px; text-align: center;">üí≠ Pensamiento de Hugo</h3>
                            <p style="font-style: italic; color: #555; text-align: center;">
                                "Javier Mart√≠nez... es un buen hombre. Tiene familia. No merece esto. Pero si confieso... 
                                el Capit√°n sabr√° que estoy investig√°ndolo. Y si realmente est√° involucrado con Los Verdes..."
                            </p>
                            <p style="font-style: italic; color: #555; text-align: center; margin-top: 15px;">
                                "No s√© si sospechar del jefe abiertamente... pero hay algo que no cuadra. 
                                ¬øQu√© hago?"
                            </p>
                        </div>
                        
                        <div style="text-align: center;">
                            <h3 style="color: #dc3545; margin-bottom: 20px;">¬øQu√© decides?</h3>
                            ${renderScapegoatChoice()}
                        </div>
                    </div>
                </div>
            `;
        }

        function renderScapegoatChoice() {
            return currentMissionData.scapegoatChoice.map(choice => {
                return `
                    <button class="button" onclick="makeScapegoatDecision('${choice.id}')" 
                            style="width: 100%; max-width: 500px; margin: 10px auto; display: block; padding: 20px; 
                                   background: ${choice.id === 'confess' ? 'linear-gradient(135deg, #e74c3c 0%, #c0392b 100%)' : 'linear-gradient(135deg, #95a5a6 0%, #7f8c8d 100%)'};">
                        ${choice.text}<br>
                        <span style="display: block; font-size: 0.85em; margin-top: 8px; opacity: 0.9;">
                            ${choice.description}
                        </span>
                    </button>
                `;
            }).join('');
        }

        function makeScapegoatDecision(choiceId) {
            stopTimer();
            const conclusion = currentMissionData.conclusions.find(c => c.id === mission4SelectedConclusion);
            const choice = currentMissionData.scapegoatChoice.find(ch => ch.id === choiceId);
            const conclusionCorrect = conclusion.correct;

            const screen = document.getElementById('game-screen');

            if (conclusionCorrect) {
                // Conclusi√≥n correcta - ahora depende de la decisi√≥n
                gameState.mission4Completed = true;
                saveProgress();
                
                const victim = choice.outcome === 'hugo_targeted' ? 'Hugo L.' : 'Detective Javier Mart√≠nez';
                const survivor = choice.outcome === 'hugo_targeted' ? 'Javier Mart√≠nez' : 'Hugo L.';

                screen.innerHTML = `
                    <div class="end-screen">
                        <div class="result-box" style="border: 4px solid #8e44ad;">
                            <h1 style="color: #8e44ad; margin-bottom: 20px;">üéØ CONCLUSI√ìN CORRECTA</h1>
                            <div style="font-size: 5em; margin: 20px 0;">üîç</div>
                            <h2 style="margin-bottom: 15px;">Has descubierto la verdad, Hugo</h2>
                            
                            <div class="story-text" style="text-align: left;">
                                <div style="background: #d4edda; padding: 20px; border-left: 4px solid #28a745; border-radius: 5px; margin-bottom: 20px;">
                                    <h3 style="color: #28a745; margin-bottom: 10px;">Tu Conclusi√≥n:</h3>
                                    <p style="margin-bottom: 10px;"><strong>${conclusion.text}</strong></p>
                                    <p>${conclusion.explanation}</p>
                                </div>

                                <div style="background: ${choice.id === 'confess' ? '#f8d7da' : '#fff3cd'}; padding: 20px; border-left: 4px solid ${choice.id === 'confess' ? '#dc3545' : '#ffc107'}; border-radius: 5px; margin-bottom: 20px;">
                                    <h3 style="color: ${choice.id === 'confess' ? '#dc3545' : '#ffc107'}; margin-bottom: 10px;">Tu Decisi√≥n:</h3>
                                    <p style="margin-bottom: 15px;"><strong>${choice.text}</strong></p>
                                    <p style="font-style: italic;">
                                        ${choice.id === 'confess' ? 
                                            'Confesaste que fuiste t√∫. El Capit√°n Rodr√≠guez no parece sorprendido...' : 
                                            'Dejaste que sospecharan de Javier Mart√≠nez. Fue interrogado y qued√≥ bajo vigilancia...'}
                                    </p>
                                </div>

                                <hr style="margin: 25px 0; border: none; border-top: 2px solid #e0e0e0;">

                                <div style="background: #2c3e50; color: white; padding: 25px; border-radius: 10px; margin-bottom: 20px;">
                                    <h3 style="color: #e74c3c; margin-bottom: 15px; text-align: center;">üíÄ EL PRECIO DE LA VERDAD</h3>
                                    <p style="margin-bottom: 15px; font-style: italic;">
                                        Una semana despu√©s, ${victim} aparece muerto en un "accidente" de tr√°fico. Un coche 
                                        lo atropell√≥ y se dio a la fuga. Sin testigos. Sin c√°maras.
                                    </p>
                                    <p style="margin-bottom: 15px; font-style: italic; color: #e74c3c; font-weight: bold;">
                                        Pero t√∫ sabes que no fue un accidente. Los Verdes eliminaron a quien sab√≠a demasiado.
                                    </p>
                                    <p style="font-style: italic;">
                                        ${choice.id === 'confess' ? 
                                            'Hugo L. est√° muerto. Su investigaci√≥n muri√≥ con √©l. Miguel nunca ser√° vengado.' : 
                                            'Javier Mart√≠nez est√° muerto. Un hombre inocente pag√≥ por tu investigaci√≥n. Pero t√∫ sigues vivo... por ahora.'}
                                    </p>
                                </div>

                                ${choice.id !== 'confess' ? `
                                    <div style="background: #fff3cd; padding: 20px; border-left: 4px solid #ffc107; border-radius: 5px; margin-bottom: 20px;">
                                        <h3 style="color: #e67e22; margin-bottom: 10px;">El Camino Contin√∫a</h3>
                                        <p style="margin-bottom: 15px;">
                                            Sigues con vida, pero con un peso en la conciencia. Javier muri√≥ por tu investigaci√≥n. 
                                            Ahora sabes que alguien poderoso protege a Los Verdes.
                                        </p>
                                        <p style="margin-bottom: 15px;">
                                            No sospechas abiertamente del Capit√°n Rodr√≠guez, pero las dudas est√°n ah√≠. Todos esos 
                                            casos archivados... su firma en cada uno...
                                        </p>
                                        <p style="font-style: italic; color: #555; margin-bottom: 15px;">
                                            Por Miguel. Por Javier. Por todas las v√≠ctimas de Los Verdes. Seguir√°s buscando la verdad, 
                                            aunque te cueste la vida.
                                        </p>
                                        <hr style="margin: 20px 0; border: none; border-top: 2px solid #e0e0e0;">
                                        <p style="font-style: italic; color: #555;">
                                            Dos semanas despu√©s del funeral de Javier, recibes una llamada an√≥nima: 
                                            <em>"Investiga la muerte del funcionario Garc√≠a. √âl tambi√©n iba a denunciar a alguien. 
                                            El caso fue archivado. R√°pido."</em>
                                        </p>
                                        <p style="font-style: italic; color: #dc3545; font-weight: bold; margin-top: 15px;">
                                            Clic. La llamada se corta. Tu coraz√≥n se acelera. Otro caso archivado... ¬øOtra pieza del rompecabezas?
                                        </p>
                                    </div>
                                ` : `
                                    <p style="font-style: italic; text-align: center; color: #555; margin-top: 20px;">
                                        <strong>FIN DEL JUEGO</strong><br>
                                        Hugo L. muri√≥ en su b√∫squeda de la verdad. La corrupci√≥n contin√∫a...
                                    </p>
                                `}

                                ${choice.id !== 'confess' ? '<p style="text-align: center; font-style: italic; color: #555; margin-top: 20px;"><strong>FIN DE LA MISI√ìN 4</strong><br>La sombra de Los Verdes es m√°s oscura de lo que imaginabas...</p>' : ''}
                            </div>

                            <div style="margin-top: 25px;">
                                ${choice.id !== 'confess' ? `
                                    <button class="button" style="background: linear-gradient(135deg, #c0392b 0%, #8e2a1f 100%);" onclick="renderMission5Unlock()">‚û°Ô∏è Investigar el Caso Garc√≠a</button>
                                ` : ''}
                                <button class="button ${choice.id !== 'confess' ? 'button-secondary' : ''}" onclick="location.reload()">üè† Volver al Men√∫ Principal</button>
                            </div>
                        </div>
                    </div>
                `;
            } else {
                // Conclusi√≥n incorrecta - despedido
                const correctConclusion = currentMissionData.conclusions.find(c => c.correct);

                screen.innerHTML = `
                    <div class="end-screen">
                        <div class="result-box result-failure">
                            <h1 style="color: #dc3545; margin-bottom: 20px;">‚ùå CONCLUSI√ìN INCORRECTA</h1>
                            <div style="font-size: 5em; margin: 20px 0;">üòû</div>
                            <h2 style="margin-bottom: 15px;">Has fallado, Hugo</h2>
                            
                            <div class="story-text" style="text-align: left;">
                                <div style="background: #f8d7da; padding: 20px; border-left: 4px solid #dc3545; border-radius: 5px; margin-bottom: 20px;">
                                    <h3 style="color: #dc3545; margin-bottom: 10px;">Tu Conclusi√≥n:</h3>
                                    <p style="margin-bottom: 10px;"><strong>${conclusion.text}</strong></p>
                                    <p><strong>Error:</strong> ${conclusion.explanation}</p>
                                </div>

                                <div style="background: #d4edda; padding: 20px; border-left: 4px solid #28a745; border-radius: 5px; margin-bottom: 20px;">
                                    <h3 style="color: #28a745; margin-bottom: 10px;">La Conclusi√≥n Correcta:</h3>
                                    <p style="margin-bottom: 10px;"><strong>${correctConclusion.text}</strong></p>
                                    <p>${correctConclusion.explanation}</p>
                                </div>

                                <hr style="margin: 20px 0; border: none; border-top: 2px solid #e0e0e0;">

                                <p style="margin-bottom: 15px; font-style: italic;">
                                    El Capit√°n Rodr√≠guez procesa tu decisi√≥n sobre ${choice.id === 'confess' ? 'confesar' : 'culpar a Mart√≠nez'}, 
                                    pero tu conclusi√≥n err√≥nea sobre los archivos revela que no entendiste el patr√≥n.
                                </p>

                                <p style="margin-bottom: 15px; font-style: italic; color: #dc3545; font-weight: bold;">
                                    "Hugo... violaste protocolos, accediste a archivos sin autorizaci√≥n, y ni siquiera llegaste 
                                    a la conclusi√≥n correcta. No puedo protegerte de esto. Tu placa. Tu arma. Est√°s despedido."
                                </p>

                                <p style="font-style: italic; color: #555;">
                                    Has fallado. Los Verdes siguen operando. Miguel nunca ser√° vengado. Y la corrupci√≥n contin√∫a.
                                </p>
                            </div>

                            <div style="margin-top: 25px;">
                                <button class="button" onclick="location.reload()">üîÑ Volver al Men√∫</button>
                            </div>
                        </div>
                    </div>
                `;
            }
        }

        function gameOver() {
            const screen = document.getElementById('game-screen');
            screen.innerHTML = `
                <div class="end-screen">
                    <div class="result-box result-failure">
                        <h1 style="color: #dc3545; margin-bottom: 20px;">‚è∞ TIEMPO AGOTADO</h1>
                        <div style="font-size: 5em; margin: 20px 0;">‚åõ</div>
                        <p style="font-size: 1.2em; margin-bottom: 20px;">
                            El tiempo se ha acabado. El asesino ha logrado escapar y desaparecer sin dejar rastro.
                        </p>
                        <div class="story-text" style="text-align: left;">
                            <p>
                                <strong style="color: #e67e22;">El culpable era: Marco "El Flaco" Silva (Traficante)</strong>
                            </p>
                            <p style="margin-top: 15px;">
                                Necesitabas actuar m√°s r√°pido. Las pistas estaban ah√≠: el arma con huellas, el s√≠mbolo verde 
                                de Los Verdes, y el testigo que lo vio huyendo. Marco actuaba bajo √≥rdenes de la banda criminal.
                            </p>
                        </div>
                        <div style="margin-top: 25px;">
                            <button class="button" onclick="location.reload()">üîÑ Intentar de Nuevo</button>
                        </div>
                    </div>
                </div>
            `;
        }

        // Inicializar el juego
        loadProgress();
        renderMainMenu();
    </script>
</body>
</html>
